# ç¬”è®°

## 2021 å¹´ 11 æœˆ 1 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 11 æœˆ 2 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 11 æœˆ 3 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 11 æœˆ 4 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 11 æœˆ 5 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 11 æœˆ 6 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 11 æœˆ 7 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 11 æœˆ 8 æ—¥

### é¦–å±æ—¶é—´ä¼˜åŒ–--è§†é¢‘

æŠ€æœ¯è¦ç‚¹ï¼š

- è§†é¢‘èµ„æºå‹ç¼©ï¼ˆå°ä¸¸å·¥å…·ç®±ï¼Œå¯ç§»é™¤éŸ³é¢‘ï¼‰
- è§†é¢‘èµ„æºæ ¼å¼è½¬æ¢ä¸º `flv` æ ¼å¼ï¼ˆå€ŸåŠ© `B` ç«™å¼€æºçš„ `flv.js`ï¼‰
- å…¶ä»–éé¦–å±èµ„æºå»¶ååŠ è½½

å®Œæ•´æ–‡æ¡£ï¼š[é¦–å±è§†é¢‘çš„ä¼˜åŒ–è¿‡ç¨‹ ğŸš€](https://segmentfault.com/a/1190000021578572)

### é¦–å±æ—¶é—´&ç™½å±æ—¶é—´

- **ç™½å±æ—¶é—´**ï¼šä»é¡µé¢æ‰“å¼€åˆ°å‡ºç°å†…å®¹æ—¶çš„æ—¶é—´ã€‚æµè§ˆå™¨åªæœ‰åŠ è½½å¹¶è§£æå®Œå¤´éƒ¨èµ„æºæ‰ä¼šçœŸæ­£æ¸²æŸ“é¡µé¢ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è·å–å¤´éƒ¨èµ„æºåŠ è½½å®Œçš„æ—¶åˆ»æ¥è¿‘ä¼¼ï¼ˆç²—ç•¥ï¼‰ç»Ÿè®¡ç™½å±æ—¶é—´

- **é¦–å±æ—¶é—´**ï¼šé¦–å±æ—¶é—´éœ€è¦è€ƒè™‘å„ç§æƒ…å†µå¦‚ï¼šå›¾ç‰‡ã€`iframe`ã€`video` ç­‰ã€‚ä»…æ–‡æœ¬æ—¶ï¼Œé¦–å±æ—¶é—´å³ä¸º `DOMContentLoaded` æ—¶é—´

#### performance API

é‡ç‚¹å…³æ³¨ `performance API`ï¼Œå…¶ä¸­åŒ…å«æœ‰ï¼š`memory`ã€`navigation`ã€`timeOrigin`ã€`timing` å››ä¸ªå±æ€§ã€‚å‡ ä¹éƒ½å¯ä»¥ä»è¿™ä¸ª `API` ä¸­æ‹¿åˆ°ç›¸å…³æ•°å€¼

åˆ†äº«ä¸ªç½‘ä¸Šæœç½—çš„å¥½ä¸œè¥¿ï¼š

```javascript
// å‡ºå¤„ï¼šhttps://juejin.cn/post/6928739992986615816
window.onload = function() {
  var timing = performance.timing
  console.log("å‡†å¤‡æ–°é¡µé¢æ—¶é—´è€—æ—¶: " + timing.fetchStart - timing.navigationStart)
  console.log("redirect é‡å®šå‘è€—æ—¶: " + timing.redirectEnd - timing.redirectStart)
  console.log("Appcache è€—æ—¶: " + timing.domainLookupStart - timing.fetchStart)
  console.log("unload å‰æ–‡æ¡£è€—æ—¶: " + timing.unloadEventEnd - timing.unloadEventStart)
  console.log("DNS æŸ¥è¯¢è€—æ—¶: " + timing.domainLookupEnd - timing.domainLookupStart)
  console.log("TCPè¿æ¥è€—æ—¶: " + timing.connectEnd - timing.connectStart)
  console.log("requestè¯·æ±‚è€—æ—¶: " + timing.responseEnd - timing.requestStart)
  console.log("ç™½å±æ—¶é—´: " + timing.responseStart - timing.navigationStart)
  console.log("è¯·æ±‚å®Œæ¯•è‡³DOMåŠ è½½: " + timing.domInteractive - timing.responseEnd)
  console.log("è§£é‡Šdomæ ‘è€—æ—¶: " + timing.domComplete - timing.domInteractive)
  console.log("ä»å¼€å§‹è‡³loadæ€»è€—æ—¶: " + timing.loadEventEnd - timing.navigationStart)
}
```

å¦å¤–ï¼Œè·å–é¦–å±æ—¶é—´å¯ä»¥ç”¨ `performance.getEntries()` è·å– `first-contentful-paint` çš„æ—¶é—´

#### æ‰‹æ‰“ï¼ˆç½‘å‚ï¼‰ä»£ç 

ç™½å±æ—¶é—´ï¼š

```html
<!-- ä»£ç æ¥æºï¼šhttps://fex.baidu.com/blog/2014/05/build-performance-monitor-in-7-days/ -->
<html>
  <head>
    <meta charset="UTF-8" />
    <script>
      //æµ‹è¯•æ—¶é—´èµ·ç‚¹ï¼Œå®é™…ç»Ÿè®¡èµ·ç‚¹ä¸º DNS æŸ¥è¯¢ï¼Œå³navigationStartæ—¶é—´
      var start_time = +new Date()
    </script>
    <!-- 3s åè¿™ä¸ª js æ‰ä¼šè¿”å› -->
    <script src="script.php"></script>
    <script>
      var end_time = +new Date() //æ—¶é—´ç»ˆç‚¹
      var headtime = end_time - start_time //å¤´éƒ¨èµ„æºåŠ è½½æ—¶é—´
      console.log(headtime)
    </script>
  </head>
  <body>
    <p>åœ¨å¤´éƒ¨èµ„æºåŠ è½½å®Œä¹‹å‰é¡µé¢å°†æ˜¯ç™½å±</p>
    <p>script.php è¢«æ¨¡æ‹Ÿè®¾ç½® 3s åè¿”å›ï¼Œhead åº•éƒ¨å†…åµŒ JS ç­‰å¾…å‰é¢ js è¿”å›åæ‰æ‰§è¡Œ</p>
    <p>script.php æ›¿æ¢æˆä¸€ä¸ªæ‰§è¡Œé•¿æ—¶é—´å¾ªç¯çš„ js æ•ˆæœä¹Ÿä¸€æ ·</p>
  </body>
</html>
```

é¦–å±æ—¶é—´ï¼š

```javascript
// è‡ªå·±ç”¨çš„è°·æ­Œï¼Œæ²¡æœ‰é‚£ä¹ˆä¸¥è°¨ï¼Œä¸èƒ½ç›´æ¥ç”¨navigationStartä½œä¸ºå¼€å§‹æ—¶é—´å“ˆ
// è¿™é‡Œåº”è¯¥åœ¨headæ ‡ç­¾å¼€å§‹æ—¶æ’å…¥ä¸€ä¸ªè·å–æ—¶é—´æˆ³çš„ä»£ç 
let max = 0
let imgs = Array.from(document.getElementsByTagName("img")) // è·å–æ‰€æœ‰çš„å›¾ç‰‡èµ„æº
imgs.forEach(tag => {
  tag.onload = function() {
    // ç›‘å¬æ¯ä¸€ä¸ªå›¾ç‰‡çš„onloadäº‹ä»¶
    imgLoad(tag, tag.classList[0])
  }
})
function imgLoad(target, name) {
  // nameæ²¡å•¥ç”¨ï¼Œæµ‹è¯•çš„æ—¶å€™æ‹¿æ¥å½“åå­—ç”¨äº†
  target.dataset.time = new Date().getTime()
  console.log(name + "åŠ è½½æ—¶é—´ï¼š" + (new Date().getTime() - performance.timing.navigationStart))
  let io = new IntersectionObserver(entries => {
    if (entries[0].intersectionRatio > 0) {
      // è¿‡æ»¤éé¦–å±çš„å›¾ç‰‡
      max = Math.max(max, new Date().getTime())
      console.log(max)
    }
    io.unobserve(target)
  })
  io.observe(target)
}
```

<!-- TODO:  -->

ç–‘é—®ï¼š

- video è§†é¢‘æ˜¯å¦ä¼šå½±å“åˆ°é¦–å±æ—¶é—´ï¼Ÿ

## 2021 å¹´ 11 æœˆ 9 æ—¥

### telepot

æ§åˆ¶æŸä¸ª `HTML` æ¨¡å—ï¼ˆç»„ä»¶ï¼‰æŒ‚è½½åˆ°æŒ‡å®šçš„ `DOM` ä¸‹ã€‚ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `id` æŒ‡å®šæŒ‚è½½çš„ `DOM`ï¼ˆ`to="#target"`ï¼‰ã€‚ä½†éœ€è¦æ³¨æ„ï¼ŒæŒ‚è½½çš„ä½ç½®ä¸ä¼šå½±å“åˆ°åŸå…ˆçš„çˆ¶å­ç»“æ„ï¼Œå³ä¸ä¼šå½±å“çˆ¶ç»„ä»¶çš„æ•°æ®æ³¨å…¥

å¦‚æœæœ‰å¤šä¸ª `teleport` æŒ‚è½½åˆ°åŒä¸€ä¸ªç›®æ ‡ä¸‹ï¼Œ`teleport` å°†ä¼šæŒ‰ç…§å…ˆåé¡ºåºæ’å…¥åˆ°ç›®æ ‡ `DOM` ä¸‹ï¼ˆæ„Ÿè§‰å±‚çº§æ¯”è¾ƒä¹±æˆ–å‡ºç°é—®é¢˜çš„æƒ…å†µä¸‹ä¼šç”¨çš„æ¯”è¾ƒå¤šå§ï¼Œå¦å¤–å…¶å®è·Ÿ `element ui` çš„ `modal-append-to-body` çš„æ•ˆæœå·®ä¸å¤šï¼Œä¸è¿‡ `teleport` å¯ä»¥æŒ‡å®šæŒ‚è½½çš„ `DOM`ï¼‰

```HTML
<teleport to="body">
  <div>
      <h2>teleport</h2>
  </div>
</teleport>
```

## 2021 å¹´ 11 æœˆ 10 æ—¥

### å…¨å±€å¼•å…¥æ–¹å¼

#### å…¨å±€å˜é‡

`vue3` ä¸­ `vue.property` å·²è¢«æ›¿æ¢æˆ `config.globalProperties`ã€‚ç”±äº `composition API` ä¸­çš„ `this` å·²ç»ä¸æ˜¯æˆ‘ä»¬ `vue2` ä¸­è®¤è¯†çš„ `this`ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡ `getCurrentInstance()` æ–¹æ³•æ¥è·å–åˆ°å½“å‰å®ä¾‹

æ­¤æ—¶è®¿é—®å…¨å±€å˜é‡çš„æ–¹å¼åˆ™å˜æˆï¼š

```javascript
// main.js
const app = createApp({})
app.config.globalProperties.$http = () => {}

// home.vue
setup() {
  const { $http } = getCurrentInstance().appContext.config.globalProperties
}

```

å°½ç®¡ä½œä¸º `vue.property` çš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆï¼Œä½† `vue3` å®˜æ–¹æ–‡æ¡£ä»å»ºè®®ç”¨ `provide` æ›¿ä»£ `globalProperties`

```javascript
// main.js
app.provide('guide', 'Vue 3 Guide')

// home.vue
setup() {
  console.log(inject('guide'))
}
// Warningï¼šinject() can only be used inside setup() or functional components.
```

#### æŒ‡ä»¤ã€ç»„ä»¶ã€æ’ä»¶ç­‰

è¿™é‡Œä»¥ component ç»„ä»¶ä¸ºä¾‹ï¼ˆå…¶ä»–ç±»ä¼¼ï¼‰

```javascript
// /testComp/index.js
// installæ–¹æ³•åŒvue2
import comp from "./index.vue"
export default {
  install: app => {
    app.component("testComp", comp)
  }
}

// main.js
// éœ€è¦useä¸€ä¸‹
import testComp from "./components/testComp"
const app = createApp(App)
app.use(testComp)
```

## 2021 å¹´ 11 æœˆ 11 æ—¥

### æˆ‘æƒ³ä¸åˆ°ç³»åˆ—ä¹‹ -- å›¾ç‰‡çš„ä¼˜åŒ–

ç»™å›¾ç‰‡åŠ ä¸Š widthã€height å±æ€§æœ‰åˆ©äº CLSï¼ˆCumulative Layout Shift ç´¯ç§¯å¸ƒå±€åç§»ï¼‰ä¼˜åŒ–ï¼Œé€šä¿—ä¸€ç‚¹æ¥è¯´å°±æ˜¯å¯ä»¥å‡å°‘é¡µé¢çš„é‡ç»˜å’Œå›æµ

ä¸ºä»€ä¹ˆå¯ä»¥å‡å°‘é¡µé¢é‡ç»˜å’Œå›æµï¼Ÿåœ¨è®¾ç½®äº† widthã€height å±æ€§ä¹‹åï¼Œæµè§ˆå™¨ä¼šæ ¹æ®å›¾åƒçš„å®½é«˜å±æ€§è®¾ç½®å›¾åƒçš„é»˜è®¤å®½é«˜æ¯”ï¼Œå› æ­¤å¼€å‘è€…åªè¦è®¾ç½®äº†å®½é«˜å…¶ä¸­ä¸€ä¸ªçš„æ•°å€¼æ—¶ï¼Œæµè§ˆå™¨ä¾¿èƒ½è®¡ç®—å‡ºå¦å¤–ä¸€ä¸ªçš„æ•°å€¼

```html
<!-- æ³¨æ„æ˜¯ä¸å¸¦å•ä½çš„widthã€heightå€¼ -->
<img src="xxx.png" width="300" height="150" />
```

```css
/* åœ¨è°·æ­Œimgä¼šå¤šäº†è¿™ä¹ˆä¸€ä¸ªé»˜è®¤å±æ€§ï¼š */
img[Attributes Style] {
  width: 313px;
  aspect-ratio: auto 313 / 428;
  height: 428px;
}
```

å‚è€ƒæ–‡æ¡£ï¼š[ä¼˜åŒ– Cumulative Layout Shift ç´¯ç§¯å¸ƒå±€åç§» ğŸš€](https://web.dev/optimize-cls/?utm_source=lighthouse&utm_medium=devtools#images-without-dimensions)

## 2021 å¹´ 11 æœˆ 12 æ—¥

### Event Bus

`vue3` ä¸­å·²åºŸé™¤ `$on`ã€`$off`ã€`$once` å®ä¾‹æ–¹æ³•ï¼Œä¸èƒ½å†åƒ `vue2` ä¸€æ ·ä½¿ç”¨ã€‚ä½† `vue3` ä¹Ÿæä¾›äº†æ›¿æ¢çš„æ–¹æ³•ï¼š[mitt](https://github.com/developit/mitt)ã€[tiny-emitter](https://github.com/scottcorgan/tiny-emitter)

å»ºè®®å°‘ç”¨...

```javascript
// tiny-emitterä½¿ç”¨å¦‚ä¸‹ï¼š
import Emitter from "tiny-emitter"
const emitter = new Emitter()
// ç»‘å®šä¸ºå…¨å±€å¯ç”¨æˆ–provideå…¨å±€æ³¨å…¥
app.config.globalProperties.emitter = emitter

// è§¦å‘ä¸ç›‘å¬äº‹ä»¶
// emitter.on('some-event', function (arg1, arg2, arg3) {})
// emitter.emit('some-event', 'arg1 value', 'arg2 value', 'arg3 value')
```

### $attrsã€$listeners

`vue3` ä¸­å·²ç»åºŸé™¤äº† `$listeners`ï¼Œåœ¨ `vue3` çš„è™šæ‹Ÿ `DOM` ä¸­ï¼Œäº‹ä»¶ç›‘å¬å™¨ç°åœ¨åªæ˜¯ä»¥ `on` ä¸ºå‰ç¼€çš„ `attribute`ï¼Œè¿™æ ·å®ƒå°±æˆä¸ºäº† `$attrs` å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä¸”å¯ä»¥é€šè¿‡ context.attrs[target] è®¿é—®

```html
<template>
  <label>
    <input type="text" v-bind="$attrs" />
  </label>
</template>
```

## 2021 å¹´ 11 æœˆ 13 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 11 æœˆ 14 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 11 æœˆ 15 æ—¥
