# 笔记

## 2021 年 10 月 1 日

缺席...

## 2021 年 10 月 2 日

缺席...

## 2021 年 10 月 3 日

缺席...

## 2021 年 10 月 4 日

缺席...

## 2021 年 10 月 5 日

缺席...

## 2021 年 10 月 6 日

缺席...

## 2021 年 10 月 7 日

缺席...

## 2021 年 10 月 8 日

缺席...

## 2021 年 10 月 9 日

缺席...

## 2021 年 10 月 10 日

缺席...

## 2021 年 10 月 11 日

### changeOrigin

`proxy` 代理的选项之一，默认值为 `false`，会保留主机头的来源。即后端获取到接口请求头中的 `host` 值即为 `devServer` 下 `host` 的值

![changeOrigin-false](../.vuepress/public/img/changeOrigin-false.png "changeOrigin-false")

若设置为 `true`，则 `host` 值为 `proxy` 下 `target` 的值

![changeOrigin-true](../.vuepress/public/img/changeOrigin-true.png "changeOrigin-true")

因此（<span style="color: rgb(192, 52, 29)">**猜测**</span>）可以设置 `changeOrigin` 为 `true`，绕过后端的 `host` 检查

## 2021 年 10 月 12 日

### Git Hook

在提交代码到 `gitlab` 时，增加一层 `hook` 限制

`vue-cli` 创建的项目会自动安装 `yorkie`（`fork` 自 `husky`，但与后者不兼容）搭配 `lint-staged` 即可实现在 `git add` 时先 `run lint`（<span style="font-size:10px;color: rgb(192, 52, 29)">妈妈再也不用担心代码给人搞乱了</span> 😎）

```json
{
  "gitHooks": {
    "pre-commit": "lint-staged"
  },
  "lint-staged": {
    "*.{js,vue}": ["vue-cli-service lint", "git add"]
  }
}
```

注意：`lint-staged` 需要 `node12.13.0+` 的版本才能正常使用

## 2021 年 10 月 13 日

缺席...

## 2021 年 10 月 14 日

缺席...

## 2021 年 10 月 15 日

### .env 环境变量文件

主要有`.env`、`.env.[env]`、`.env.[env].local` 三种类型文件（`[env]` 指各种环境），优先级从左到右递增，其中 `.env.[env].local` 只在本地生效并且一般不提交到 `gitlab`，常用于多人合作开发时部署自己的联调环境

环境变量文件中，只有 `NODE_ENV`, `BASE_URL` 和以 `VUE_APP_` 开头的变量能通过 webpack.DefinePlugin 静态地嵌入到代码中

## 2021 年 10 月 16 日

缺席...

## 2021 年 10 月 17 日

缺席...

## 2021 年 10 月 18 日

\------------------------------------------------------

大致过完一遍 vue-cli4 官方文档...  
稍微熟悉了其中的配置...  
但手写 chainWebpack 还是有点困难...  
常用的插件也暂时没看...  
留着过 webpack 的时候再看吧...  
这个月好像断档的有点多...  
得努力了...  
hope...
祈っている...
🙏🙏🙏

## 2021 年 10 月 19 日

### 从 0 开始搞 webpack

需要选定一个入口文件作为内部依赖关系图的“开始”，默认输入路径为 `/dist`；所有需要使用到的文件都需要在入口文件中引用

各种常见类型文件对应处理 loader：

| 文件类型                     | 对应 loader               |
| ---------------------------- | ------------------------- |
| js                           | default                   |
| css                          | style-loader、css-loader  |
| scss                         | node-sass、sass-loader    |
| less                         | less-loader               |
| png \| jpg \| gif \| svg     | file-loader \| url-loader |
| ttf \| woff(2) \| otf \| eot | file-loader               |

- 处理 `css` 的 `loader` 顺序为：`css-loader` -> `style-loader`
- 处理 `scss` 文件需要使用 `sass-loader`，前提是需要安装 `node-sass` 依赖
- 若要将小 `icon` 转换成 `base64`，需要用到 `url-loader`
- `url-loader` 和 `file-loader` 只需要使用其中一个即可处理图片文件

### html-webpack-plugin

默认情况下 htmlwebpackplugin 会自动生成一个 HTML 文件，也可以自定义选定 template 文件

```javascript
plugins: {
  new htmlwebpackplugin({
    title: "测试title",
    filename: "index.html",
    template: path.resolve(__dianame, "realpath/template.html")
  })
}
```

指定 `template` 文件后，`htmlwebpackplugin` 会自动注入相关的 css、js 文件等

如上，指定 `template` 且设置了 title 参数后，如果 `template` 文件中已经设置了标题，那么 title 将不生效，需要通过 `<%= htmlWebpackPlugin.options.title %>` 获取到配置中的 title 参数

如果需要指定多入口文件：

需要 `new` 多几个 `htmlwebpackplugin` 对象，同时修改 `entry` 和 `output` 参数

- 更多相关 api 请查阅：[html-webpack-plugin 🚀](https://github.com/jantimon/html-webpack-plugin#options)

### clean-webpack-plugin

每次构建项目之前清理 /dist 文件夹

使用时需要注意：

```javascript
// webpack.config.js
// const CleanWebpackPlugin  = require('clean-webpack-plugin') 错误
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

plugins: [
  new CleanWebpackPlugin()
],

```

**Otherwise**：可以借助 `node.js` 的 `file` 模块进行文件夹删除

**思考**：new CleanWebpackPlugin() 放置的位置会不会影响到最终的效果？

- 更多相关配置可查阅：[clean-webpack-plugin 🚀](https://github.com/johnagan/clean-webpack-plugin#usage)

## 2021 年 10 月 20 日

### source-map

将编译后的代码映射回源代码，用于开发环境

相关 source-map 类型及对应打包速度如下：

> `+++` 非常快速, `++` 快速, `+` 比较快, `o` 中等, `-` 比较慢, `--` 慢

| devtool                        | 构建速度 | 重构速度 | 生产环境 | 品质（quality）        |
| ------------------------------ | -------- | -------- | -------- | ---------------------- |
| none                           | +++      | +++      | yes      | 打包后的代码           |
| eval                           | +++      | +++      | no       | 生成后的代码           |
| cheap-eval-source-map          | +        | ++       | no       | 转换过的代码（仅限行） |
| cheap-module-eval-source-map   | o        | ++       | no       | 原始源代码（仅限行）   |
| eval-source-map                | --       | +        | no       | 原始源代码             |
| cheap-source-map               | +        | o        | yes      | 转换过的代码（仅限行） |
| cheap-module-source-map        | o        | -        | yes      | 原始源代码（仅限行）   |
| inline-cheap-source-map        | +        | o        | no       | 转换过的代码（仅限行） |
| inline-cheap-module-source-map | o        | -        | no       | 原始源代码（仅限行）   |
| source-map                     | --       | --       | yes      | 原始源代码             |
| inline-source-map              | --       | --       | no       | 原始源代码             |
| hidden-source-map              | --       | --       | yes      | 原始源代码             |
| nosources-source-map           | --       | --       | yes      | 无源代码内容           |

- 相关使用场景可参考：[devtool 🚀](https://v4.webpack.docschina.org/configuration/devtool#%E5%AF%B9%E4%BA%8E%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83)
- 相关测试效果用例：[source-map 🚀](https://github.com/webpack/webpack/tree/main/examples/source-map)
