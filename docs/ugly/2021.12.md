# ç¬”è®°

## 2021 å¹´ 12 æœˆ 1 æ—¥

### è§£æ„èµ‹å€¼

æ”¶å½•äº†ä¸€äº›ç»“æ„èµ‹å€¼å¸¸ç”¨çš„åœºæ™¯~

æ–‡æ¡£åœ°å€ï¼š[ES6 å®˜æ–¹æ–‡æ¡£ ğŸš€](https://es6.ruanyifeng.com/?search=%3F%3F&x=3&y=5#docs/destructuring#%E7%94%A8%E9%80%94)

#### äº¤æ¢å˜é‡çš„å€¼

```javascript
let x = 1
let y = 2

;[x, y] = [y, x]
```

#### ä»å‡½æ•°è¿”å›å¤šä¸ªå€¼

```javascript
function example() {
  return {
    foo: 1,
    bar: 2
  }
}
let { foo, bar } = example()
// åŒè¿”å›æ•°ç»„
```

#### å‡½æ•°å‚æ•°çš„å®šä¹‰

```javascript
// å‚æ•°æ˜¯ä¸€ç»„æœ‰æ¬¡åºçš„å€¼
function f([x, y, z]) { ... }
f([1, 2, 3]);

// å‚æ•°æ˜¯ä¸€ç»„æ— æ¬¡åºçš„å€¼
function f({x, y, z}) { ... }
f({z: 3, y: 2, x: 1});
```

#### æå– JSON æ•°æ®

```javascript
let jsonData = {
  id: 42,
  status: "OK",
  data: [867, 5309]
}

let { id, status, data: number } = jsonData
```

#### å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼

```javascript
jQuery.ajax = function(
  url,
  {
    async = true,
    beforeSend = function() {},
    cache = true,
    complete = function() {},
    crossDomain = false,
    global = true
    // ... more config
  } = {}
) {
  // ... do stuff
}
```

#### éå† MAP ç»“æ„

```javascript
const map = new Map()
map.set("first", "hello")
map.set("second", "world")

for (let [key, value] of map) {
  console.log(key + " is " + value)
}
```

#### è¾“å…¥æ¨¡å—çš„æŒ‡å®šæ–¹æ³•

```javascript
const { SourceMapConsumer, SourceNode } = require("source-map")
```

## 2021 å¹´ 12 æœˆ 2 æ—¥

### BigInt

å·ç§° ECMAScript çš„ç¬¬å…«ç§æ•°æ®ç±»å‹ã€‚æœ‰ä»¥ä¸‹ç‰¹ç‚¹

- å¿…é¡»åŠ ä¸Šåç¼€ `n`
- åªç”¨äºè¡¨ç¤ºæ•´æ•°
- ä¸é™äºå„ç§è¿›åˆ¶
- æ²¡æœ‰ä½æ•°é™åˆ¶
- å¯ä»¥ä½¿ç”¨è´Ÿå·ï¼Œä½†ä¸èƒ½ä½¿ç”¨æ­£å·ï¼ˆ`+`ï¼‰
- ä¸æ™®é€šæ•´æ•°ä¸ç›¸ç­‰ï¼š `42n === 42` çš„ç»“æœä¸º `false`
- `typeof` è¿”å›çš„å€¼ä¸º `BigInt`

å¯ä»¥é€šè¿‡ `BigInt()` å‡½æ•°å°†å…¶ä»–ç±»å‹è½¬æ¢æˆ `BigInt`

`BigInt` è¿˜åŒ…å« `toString()`ã€`valueOf()`ã€`toLocaleString()` ç­‰ä¸€äº›[æ–¹æ³• ğŸš€](https://es6.ruanyifeng.com/?search=%3F%3F&x=3&y=5#docs/number#BigInt-%E5%87%BD%E6%95%B0)

## 2021 å¹´ 12 æœˆ 3 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 12 æœˆ 4 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 12 æœˆ 5 æ—¥

ç¼ºå¸­...

## 2021 å¹´ 12 æœˆ 6 æ—¥

### referer === referrer ï¼Ÿ

`HTTP` ä¸­çš„ `referer` æ˜¯è¯·æ±‚å¤´çš„ä¸€ä¸ªå­—æ®µï¼Œç”¨äºè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ä»å“ªä¸ªæ¥æºç½‘é¡µå‘å‡ºçš„ï¼Œå³å¯ä»¥æ£€æŸ¥è®¿å®¢ä»å“ªé‡Œæ¥ï¼Œä¹Ÿå¯ä»¥ç”¨äºå¯¹ä»˜ä¼ªé€ çš„è·¨ç½‘ç«™è¯·æ±‚ï¼ˆcsrfï¼‰

`referer` çš„æ­£ç¡®è‹±æ–‡æ˜¯ `referrer`ï¼Œè¿™æ˜¯æ—©æœŸ `HTTP` è§„èŒƒå½“ä¸­å­˜åœ¨çš„æ‹¼å†™é”™è¯¯ï¼Œåæ¥ä¸ºäº†ä¿æŒå‘ä¸‹å…¼å®¹å°±å°†é”™å°±é”™ã€‚ä¸€èˆ¬è¯´ `referrer` æŒ‡çš„å°±æ˜¯ `document.referrer`ï¼Œ

å› å¼•ç”¨åœ°å€ä¿¡æ¯ `referer` å¯èƒ½ä¼šå¸¦æ¥éšç§æƒé—®é¢˜ï¼Œä¸å°‘ç½‘é¡µæµè§ˆå™¨å…è®¸ç”¨æˆ·è®¾ç½®ä¸è¦æäº¤è¿™ä¸ªä¿¡æ¯ï¼Œæœ‰äº›ä»£ç†æœåŠ¡å™¨å’Œé˜²ç«å¢™ä¹Ÿä¼šå°†å¼•ç”¨åœ°å€ä¿¡æ¯è¿‡æ»¤æ‰ï¼Œä»¥é¿å…å¤–éƒ¨è·çŸ¥éå…¬å¼€çš„ç½‘ç»œåœ°å€ã€‚å› æ­¤å¦‚æœæƒ³è¦ä¿è¯ referer ä¿¡æ¯çš„ä¸Šä¼ ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹ meta å¤´

```html
<meta content="always" name="referrer" />
```

`referer` ä¸è¢«å…è®¸ä¿®æ”¹ï¼Œæµè§ˆå™¨ä¼šæç¤ºï¼š`Refused to set unsage header "Referer"`

å…¶ä»–ä¸èƒ½ä¿®æ”¹çš„è¯·æ±‚å¤´å¦‚ä¸‹ï¼š

```text
Accept-Charset
Accept-Encoding
Access-Control-Request-Headers
Access-Control-Request-Method
Connection
Content-Length
Cookie
Cookie2
Date
DNT
Expect
Feature-Policy
Host
Keep-Alive
Origin
Proxy-
Sec-
Referer
TE
Trailer
Transfer-Encoding
Upgrade
Via
```

## 2021 å¹´ 12 æœˆ 7 æ—¥

### Content-Security-Policy

ä½œä¸ºå‰ç«¯å¼€å‘ï¼Œåº”è¯¥éƒ½çŸ¥é“æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼šæµè§ˆå™¨ä»…åŠ è½½åŒåè®®ã€åŸŸååŠç«¯å£çš„è„šæœ¬æ–‡æ¡£ã€‚`Content-Security-Policy` ä¹Ÿå°±æ˜¯æµè§ˆå™¨å†…å®¹å®‰å…¨ç­–ç•¥ `CSP`ï¼Œå…¶å®‰å…¨æ¨¡å¼ä¹Ÿæ˜¯æ¥æºäºâ€œåŒæºç­–ç•¥â€ï¼Œé€šè¿‡æ§åˆ¶è„šæœ¬/èµ„æºçš„æ¥æºæ¥è¾¾åˆ°ä¿è¯å®‰å…¨çš„ç›®çš„ã€‚`CSP` æ˜¯ä¸€ä¸ªå¯ä»¥æ˜¾è‘—é™ä½ `XSS` æ”»å‡»çš„é£é™©å’Œå½±å“çš„ä¸€ç§é˜²æŠ¤åŠŸèƒ½

<!-- æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨é…ç½® `CSP`ï¼Œé’ˆå¯¹å„ç§èµ„æºè¿›è¡Œæ¥æºæ§åˆ¶ -->

`CSP` å¯é€šè¿‡ `http` æ ‡å¤´ï¼ˆé¦–é€‰ä¸”ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œä¸€èˆ¬åœ¨ `nginx` é…ç½®ï¼‰æˆ– `meta` æ ‡ç­¾è¿›è¡Œé…ç½®ï¼Œç›¸å…³å¯é…ç½®èµ„æºæœ‰å¦‚ä¸‹ï¼š

```html
<!-- metaæ ‡ç­¾ä½¿ç”¨æ–¹å¼ -->
<meta
  http-equiv="Content-Security-Policy"
  content="default-src https://cdn.example.net; child-src 'none'; object-src 'none'"
/>
```

| name                      | policy                                                 |
| ------------------------- | ------------------------------------------------------ |
| base-uri                  | é™åˆ¶ `base` æ ‡ç­¾å†…å®¹æ¥æº                               |
| child-src                 | é™åˆ¶ `iframe` å†…å®¹æ¥æº                                 |
| connect-src               | é™åˆ¶ `http` è¯·æ±‚åœ°å€ï¼ˆ`XHR`ã€`WS`ã€`EventSource`ï¼‰     |
| font-src                  | é™åˆ¶å­—ä½“æ–‡ä»¶æ¥æºåœ°å€                                   |
| form-action               | é™åˆ¶ `form` è¡¨å•æäº¤åœ°å€                               |
| frame-ancestors           | é™åˆ¶è¢« `iframe` åµŒå¥—çš„æ¥æºåœ°å€ï¼ˆä¸èƒ½åœ¨ `HTML` ä¸Šä½¿ç”¨ï¼‰ |
| frame-src                 | å·²å¼ƒç”¨ã€‚è¯·æ”¹ç”¨ `child-src`                             |
| img-src                   | é™åˆ¶å›¾ç‰‡èµ„æºåœ°å€                                       |
| media-src                 | é™åˆ¶éŸ³è§†é¢‘èµ„æºåœ°å€                                     |
| object-src                | é™åˆ¶ `flash` æ¥æºåœ°å€ï¼ˆå¯æ‰§è¡Œå¤–éƒ¨ `js` ä»£ç ï¼‰          |
| plugin-types              | é™åˆ¶æ’ä»¶æ¥æºåœ°å€                                       |
| report-uri                | é™åˆ¶å‘é€æŠ¥å‘Šçš„åœ°å€ï¼ˆä¸èƒ½ç”¨äº `meta`ï¼‰                  |
| script-src                | é™åˆ¶ `js` æ¥æºåœ°å€                                     |
| style-src                 | é™åˆ¶ `css` æ¥æºåœ°å€                                    |
| upgrade-insecure-requests | æŒ‡ä½¿ `UserAgent` å°† `HTTP` æ›´æ”¹ä¸º `HTTPS`              |

éœ€è¦é’ˆå¯¹æŸä¸€é¡¹æŒ‡ä»¤é…ç½®å¤šä¸ªå€¼æ—¶ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ å¤šä¸ªå€¼ã€‚æ³¨æ„ä¸­é—´åªéœ€è¦ç©ºæ ¼éš”å¼€ã€‚å¤šé¡¹æŒ‡ä»¤ç”¨ `ï¼›` éš”å¼€

```shell
script-src https://host1.com https://host2.com
```

å¦‚æœä¸é’ˆå¯¹æŸä¸€é¡¹æŒ‡ä»¤è®¾ç½®å€¼æ—¶ï¼Œé»˜è®¤ä»¥ \* ä½œä¸ºæœ‰æ•ˆæ¥æºï¼ˆå³ç›¸å½“äºæ— é™åˆ¶ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ `default-src` æŒ‡ä»¤æ›¿æ¢é»˜è®¤è¡Œä¸ºï¼Œä½†éœ€è¦æ³¨æ„ï¼Œ`default-src` ä¸»è¦é’ˆå¯¹ `-src` ç±»æŒ‡ä»¤çš„æ¥æºè¿›è¡Œé™åˆ¶

æŒ‡ä»¤çš„å€¼å¯ä»¥æŒ‡å®šåŸŸååœ°å€ï¼Œä¹Ÿå¯ä»¥æœ‰ä»¥ä¸‹ï¼ˆä¸é™ï¼Œéƒ¨åˆ†é¡¹æ²¡åˆ—ä¸¾å‡ºæ¥ï¼Œåªæ˜¯å¸¸ç”¨é¡¹ï¼‰å‡ ç§å…³é”®å­—ï¼š

| name          | desc                     |
| ------------- | ------------------------ |
| none          | ä¸æ‰§è¡Œä»»ä½•åŒ¹é…           |
| self          | ä¸å½“å‰æ¥æºï¼ˆéå­åŸŸï¼‰åŒ¹é… |
| unsafe-inline | å…è®¸å†…è” `js` å’Œ `css`   |
| unsafe-eval   | å…è®¸æ‰§è¡Œ `eval` ç­‰å‘½ä»¤   |

å¦‚æœè®¾ç½®äº† `unsafe-inline` æˆ– `unsafe-eval`ï¼Œéœ€è¦åšè¿›ä¸€æ­¥çš„å¤„ç†ã€‚ç”±äº CSP å¯ä»¥æ˜ç¡®è§„å®šå“ªäº›ä¸ºæµè§ˆå™¨å¯æ¥å—çš„èµ„æºé›†ï¼Œå¦‚æœæ˜¯é‡‡ç”¨ XSS æ”»å‡»ï¼ˆå†…è”è„šæœ¬ï¼‰ï¼Œè¿™æ˜¯æ— æ³•å¤„ç†çš„ã€‚å¦‚æœè¦ä½¿ç”¨çš„è¯ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªåŠ å¯†éšæœºæ•°ï¼ˆä»…ä½¿ç”¨ä¸€æ¬¡ï¼‰æˆ–ä¸€ä¸ªå“ˆå¸Œå€¼å°†æŒ‡å®šè„šæœ¬åˆ—å…¥ç™½åå•

```html
<!-- ç”ŸæˆåŠ å¯†éšæœºæ•° -->
<script nonce="EDNnf03nceIOfn39fn3e9h3sdfa"></script>
Content-Security-Policy: script-src 'nonce-EDNnf03nceIOfn39fn3e9h3sdfa'

<!-- è®¡ç®—è„šæœ¬è‡ªèº«çš„SHAå“ˆå¸Œå€¼å¹¶æ’å…¥åˆ°script-srcæŒ‡ä»¤ä¸­ -->
Content-Security-Policy: script-src 'sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng='
<!-- æˆ–è€… -->
```

ç›¸å…³æ–‡æ¡£ï¼š[ç½‘ç»œåŸºç¡€ ğŸš€](https://developers.google.com/web/fundamentals/security/csp?hl=zh-cn)

<!-- Referrer-Policy -->

## 2021 å¹´ 12 æœˆ 8 æ—¥

### Mixed Contents

æ··åˆå†…å®¹ï¼ˆ`mixed contents`ï¼‰ï¼šå½“ `https` é¡µé¢åŒ…å«æœ‰ `http` çš„å†…å®¹æ—¶ï¼Œå³ä¸º `mixed-contents`ã€‚è¿™ç§é¡µé¢éƒ¨åˆ†åŠ å¯†ï¼Œéƒ¨åˆ†æœªåŠ å¯†ï¼Œå®¹æ˜“å—åˆ°æ”»å‡»

ä» `Chrome 79` å¼€å§‹ï¼Œ`Chrome` å°†é€æ¸è½¬å‘é»˜è®¤é˜»æ­¢æ‰€æœ‰æ··åˆå†…å®¹ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å°†æ··åˆèµ„æºå‡çº§åˆ° `https://`

å¯ä»¥é€šè¿‡ `CSP` é…ç½®ç›¸å…³æŒ‡ä»¤ï¼ˆå–å€¼ç›®å‰å°±æ‰¾åˆ°ä¸€ä¸ª...ï¼‰ï¼š

```html
<meta http-equiv="Content-Security-Policy" content="block-all-mixed-content" />
```

è°·æ­Œæ—¥å¿—æ–‡æ¡£ï¼š<https://blog.chromium.org/2019/10/no-more-mixed-messages-about-https.html>

## 2021 å¹´ 12 æœˆ 9 æ—¥

### Referrer-Policy

è¿™é‡Œçš„ `Referrer-Policy` æ˜¯æŒ‡ `http` å“åº”å¤´çš„å‚æ•°ï¼Œå…¶ç”¨æ¥ç›‘ç®¡å“ªäº›è®¿é—®æ¥æºä¿¡æ¯ä¼šåœ¨ `referrer` ä¸­å‘é€ï¼ˆå¯ä»¥ç†è§£ä¸º `A` é¡µé¢è·³è½¬åˆ° `B` é¡µé¢æ—¶æ‰€åŒ…å«çš„ `A` çš„æ¥æºä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ `document.referrer` è·å–ï¼‰ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š

| å€¼                                    | æè¿°                                   |
| ------------------------------------- | -------------------------------------- |
| no-referrer                           | ä¸ä¼šå‘é€                               |
| no-referrer-when-downgradeï¼ˆdefaultï¼‰ | åŒå®‰å…¨çº§åˆ«ä¸‹ä¼šå‘é€ï¼ˆhttps=>httpsï¼‰     |
| origin                                | ä»…å‘é€åŸŸå                             |
| origin-when-cross-origin              | åŒæºä¸‹å‘é€å®Œæ•´çš„ URLï¼Œå¦åˆ™ä»…å‘é€åŸŸå   |
| same-origin                           | åŒæºä¸‹å‘é€                             |
| strict-origin                         | åŒå®‰å…¨çº§åˆ«ä¸‹å‘é€åŸŸå                   |
| strict-origin-when-cross-origin       | åŒæºä¸‹å‘é€å®Œæ•´ urlï¼ŒåŒå®‰å…¨çº§åˆ«å‘é€åŸŸå |
| unsafe-url                            | å‘é€å®Œæ•´ url                           |

å¯é€šè¿‡ `meta` æ ‡ç­¾è¿›è¡Œè®¾ç½®ã€‚

```html
<meta name="referrer" content="no-referrer" />
```

æµ‹è¯•å‘ç°ï¼šä¿®æ”¹äº† `Referrer-Policy` åï¼Œ`js`ã€`css` ç­‰èµ„æºéƒ½æ›´æ”¹æˆå¯¹åº”å€¼ï¼Œä½†å¯¹ `index.html`ï¼ˆ`localhost`ï¼‰è¿™ä¸ªæ–‡ä»¶å´ä¸ä¸€å®šï¼Œå…¶ä»–å¦‚ï¼šéƒ¨åˆ†å›¾ç‰‡ã€å­—ä½“æ–‡ä»¶ç­‰ä¹Ÿä¸ä¸€å®šä¼šè·Ÿéšæ”¹å˜ã€‚å…·ä½“åŸå› æš‚æœªæŸ¥æ˜

<!-- TODO: æŸ¥ä¸€ä¸‹ä¸ºä»€ä¹ˆæœ‰äº›èµ„æºä¸ä¼šè·Ÿéšæ”¹å˜referrer-policyå€¼ -->

> TIPSï¼šè¿™éƒ¨åˆ†å†…å®¹è·Ÿ referrerã€CSP ç­‰å†…å®¹æŒºç›¸å…³çš„ï¼Œå¯ä»¥ç»“åˆä¸€èµ·çœ‹çœ‹ä¼šæ›´å¥½ä¸€äº›ï¼ˆå¯ç›´æ¥æœç´¢ï¼‰

å‚è€ƒæ–‡æ¡£ï¼š

- <https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Referrer-Policy>
- <https://segmentfault.com/a/1190000022101053?utm_source=sf-similar-article>
- <https://segmentfault.com/a/1190000017896469>

## 2021 å¹´ 12 æœˆ 10 æ—¥

### Cannot read property 'tapPromise' of undefined

è¿™é‡Œæ˜¯æŒ‡ä½¿ç”¨ `compression-webpack-plugin` æ—¶é‡åˆ° `Cannot read property 'tapPromise' of undefined` å¼‚å¸¸çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

å‡ºç°è¿™ä¸ªå¼‚å¸¸çš„é—®é¢˜æ˜¯ç”±äº `webpack` ç‰ˆæœ¬å¯¼è‡´ã€‚æœ€æ–°ç‰ˆçš„æ’ä»¶ä»…é€‚ç”¨äº `webpack5`ï¼Œè€Œå¯¹äº `webpack4` å·²ç»ä¸æ”¯æŒã€‚å› æ­¤éœ€è¦é™ä½ `compression-webpack-plugin` æ’ä»¶çš„ç‰ˆæœ¬ã€‚

ç»æµ‹è¯• `6.1.1` ç‰ˆæœ¬å¯æ»¡è¶³ webpack4 çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸‹è½½æ¬¡æ•°è¾ƒå¤šçš„ä¸€ä¸ªç‰ˆæœ¬
