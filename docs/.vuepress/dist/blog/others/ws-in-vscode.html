<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ç ”(kÃ n)ç©¶(kÃ n) ğŸ‘¨â€ğŸ’»vscode ä¸­çš„ websocket | WolfBerry</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="WolfBerry's Blog">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.47866b07.css" as="style"><link rel="preload" href="/Blog/assets/js/app.389f9714.js" as="script"><link rel="preload" href="/Blog/assets/js/2.35933c35.js" as="script"><link rel="preload" href="/Blog/assets/js/23.ad5e4d4c.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.f7b97e6b.js"><link rel="prefetch" href="/Blog/assets/js/11.9f558382.js"><link rel="prefetch" href="/Blog/assets/js/12.df99e890.js"><link rel="prefetch" href="/Blog/assets/js/13.2dba2a69.js"><link rel="prefetch" href="/Blog/assets/js/14.a46b7776.js"><link rel="prefetch" href="/Blog/assets/js/15.ecb2ce21.js"><link rel="prefetch" href="/Blog/assets/js/16.6d870dd2.js"><link rel="prefetch" href="/Blog/assets/js/17.a939d82d.js"><link rel="prefetch" href="/Blog/assets/js/18.b64b4531.js"><link rel="prefetch" href="/Blog/assets/js/19.9be0693a.js"><link rel="prefetch" href="/Blog/assets/js/20.a30d2ee0.js"><link rel="prefetch" href="/Blog/assets/js/21.3d9d5a6d.js"><link rel="prefetch" href="/Blog/assets/js/22.fc0c7a9a.js"><link rel="prefetch" href="/Blog/assets/js/24.63b33558.js"><link rel="prefetch" href="/Blog/assets/js/25.ca59a49e.js"><link rel="prefetch" href="/Blog/assets/js/26.b7aabc62.js"><link rel="prefetch" href="/Blog/assets/js/27.7ce1e886.js"><link rel="prefetch" href="/Blog/assets/js/28.f0f9a575.js"><link rel="prefetch" href="/Blog/assets/js/29.609f5aa3.js"><link rel="prefetch" href="/Blog/assets/js/3.ac356001.js"><link rel="prefetch" href="/Blog/assets/js/30.5b1441f1.js"><link rel="prefetch" href="/Blog/assets/js/4.d257aed5.js"><link rel="prefetch" href="/Blog/assets/js/5.83ae5ad3.js"><link rel="prefetch" href="/Blog/assets/js/6.50900788.js"><link rel="prefetch" href="/Blog/assets/js/7.5ff65720.js"><link rel="prefetch" href="/Blog/assets/js/8.59250db5.js"><link rel="prefetch" href="/Blog/assets/js/9.d1e48c3e.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.47866b07.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">WolfBerry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/blog/" class="nav-link router-link-active">
  Blog
</a></div><div class="nav-item"><a href="/Blog/demo/" class="nav-link">
  Demo
</a></div><div class="nav-item"><a href="/Blog/diary/" class="nav-link">
  Diary
</a></div> <a href="https://github.com/Real102/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/blog/" class="nav-link router-link-active">
  Blog
</a></div><div class="nav-item"><a href="/Blog/demo/" class="nav-link">
  Demo
</a></div><div class="nav-item"><a href="/Blog/diary/" class="nav-link">
  Diary
</a></div> <a href="https://github.com/Real102/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>åšå®¢</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/blog/" aria-current="page" class="sidebar-link">ä»‹ç»</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/blog/html/meta.html" class="sidebar-link">å¸¸ç”¨çš„metaæ ‡ç­¾</a></li><li><a href="/Blog/blog/html/unicode.html" class="sidebar-link">å­—ç¬¦ç¼–ç </a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/blog/javascript/get-image-size.html" class="sidebar-link">é™åˆ¶ä¸Šä¼ å›¾ç‰‡çš„å°ºå¯¸</a></li><li><a href="/Blog/blog/javascript/preload-image.html" class="sidebar-link">å›¾ç‰‡é¢„åŠ è½½</a></li><li><a href="/Blog/blog/javascript/lazyload.html" class="sidebar-link">å›¾ç‰‡æ‡’åŠ è½½çš„ä¸¤ç§å®ç°æ–¹å¼</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/blog/vue/img-in-vue.html" class="sidebar-link">åœ¨vueé¡¹ç›®ä¸­å¼•å…¥å›¾ç‰‡</a></li><li><a href="/Blog/blog/vue/vue-env.html" class="sidebar-link">vue ç¯å¢ƒå˜é‡çš„è®¾ç½®ä¸ä½¿ç”¨</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/blog/webpack/require-context.html" class="sidebar-link">require.context çš„å¦™ç”¨</a></li><li><a href="/Blog/blog/webpack/lodash.html" class="sidebar-link">lodash æŒ‰éœ€å¼•å…¥åŠæ‰“åŒ…ä¼˜åŒ–</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç§»åŠ¨ç«¯</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/blog/mobile/preview-on-mobile.html" class="sidebar-link">æ‰‹æœºç«¯é¢„è§ˆvueé¡¹ç›®</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>å…¶ä»–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/blog/others/nvm.html" class="sidebar-link">ä½¿ç”¨ nvm æ¥ç®¡ç† npm</a></li><li><a href="/Blog/blog/others/vscode-for-web.html" class="sidebar-link">æ­å»º web ç‰ˆ vs code</a></li><li><a href="/Blog/blog/others/ws-in-vscode.html" aria-current="page" class="active sidebar-link">ç ”ç©¶vscodeä¸­çš„websocket</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/blog/others/ws-in-vscode.html#å‰è¨€" class="sidebar-link">å‰è¨€</a></li><li class="sidebar-sub-header"><a href="/Blog/blog/others/ws-in-vscode.html#æ‰“åŒ…æµç¨‹" class="sidebar-link">æ‰“åŒ…æµç¨‹</a></li><li class="sidebar-sub-header"><a href="/Blog/blog/others/ws-in-vscode.html#å…³é”®ä»£ç è§£æ" class="sidebar-link">å…³é”®ä»£ç è§£æ</a></li><li class="sidebar-sub-header"><a href="/Blog/blog/others/ws-in-vscode.html#è¸©è¿‡çš„æ— åº•æ´-ğŸ•³" class="sidebar-link">è¸©è¿‡çš„æ— åº•æ´ ğŸ•³</a></li><li class="sidebar-sub-header"><a href="/Blog/blog/others/ws-in-vscode.html#çŒœæµ‹" class="sidebar-link">çŒœæµ‹</a></li><li class="sidebar-sub-header"><a href="/Blog/blog/others/ws-in-vscode.html#å…¶ä»–" class="sidebar-link">å…¶ä»–</a></li><li class="sidebar-sub-header"><a href="/Blog/blog/others/ws-in-vscode.html#å‚è€ƒæ–‡æ¡£" class="sidebar-link">å‚è€ƒæ–‡æ¡£</a></li></ul></li><li><a href="/Blog/blog/others/format-phone.html" class="sidebar-link">æ‰‹æœºå·è¾“å…¥æ¡†çš„æ ¼å¼åŒ–æ˜¾ç¤º</a></li><li><a href="/Blog/blog/others/data-type.html" class="sidebar-link">æ•°æ®ç±»å‹ä¸è½¬æ¢</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ç ”-kan-ç©¶-kan-ğŸ‘¨â€ğŸ’»vscode-ä¸­çš„-websocket"><a href="#ç ”-kan-ç©¶-kan-ğŸ‘¨â€ğŸ’»vscode-ä¸­çš„-websocket" class="header-anchor">#</a> ç ”(kÃ n)ç©¶(kÃ n) ğŸ‘¨â€ğŸ’»vscode ä¸­çš„ websocket</h1> <h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>å› é¡¹ç›®è¦æ±‚ï¼Œè¦å¯¹ <code>vscode</code> çš„ <code>websocket</code> ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ç”±äºå¯¹ <code>ts</code> å’Œ <code>node</code> ä¸å¤Ÿç†Ÿæ‚‰ï¼Œåœ¨æ’ç ´äº†å‡ ä¸ªè„‘è¢‹ä¹‹åï¼Œè®°å½•ä¸‹è‡ªå·±çš„ä¸€äº›ç†è§£ã€‚</p> <p><code>vscode</code> æ˜¯åŸºäº <code>typescript</code> å’Œ <code>node</code> (æ¡Œé¢ç‰ˆï¼š<code>electron</code>)ï¼Œåœ¨çœ‹ä¸‹é¢çš„å†…å®¹å‰ï¼Œå»ºè®®æå‰äº†è§£ä¸€ä¸‹ <a href="https://real102.github.io/Blog/blog/others/data-type.html" target="_blank" rel="noopener noreferrer">Bufferã€ArrayBufferã€TypedArray<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€ ä»¥åŠä½è¿ç®—ç­‰ï¼Œä¼šæ›´åŠ å®¹æ˜“ç†è§£</p> <h2 id="æ‰“åŒ…æµç¨‹"><a href="#æ‰“åŒ…æµç¨‹" class="header-anchor">#</a> æ‰“åŒ…æµç¨‹</h2> <ul><li>ç¯å¢ƒé€‰æ‹©ï¼šUbuntuã€debian</li> <li>è¿›å…¥é¡¹ç›®æ ¹ç›®å½• <code>code-sever &gt;</code></li> <li>æ‰§è¡Œ <code>yarn</code> å®‰è£…ä¾èµ–</li> <li>æ‰“åŒ… <code>yarn build 1.39.2 { codeservername }</code> åå­—éšæ„å–ï¼Œè¿™ä¸€æ­¥å°†ç”Ÿæˆ <code>/build/code-server{ codeservername }-vsc1.39.2-linux-x86_64-built</code> ï¼ˆæ¯”è¾ƒèŠ±æ—¶é—´ï¼‰</li> <li>æ‰§è¡Œ <code>node /path/to/output/build/out/vs/server/main.js</code> è¿™ä¸€æ­¥æ˜¯è·‘ demoï¼Œä½†æ³¨æ„ <strong>window ä¸‹è·‘ä¸äº†çš„</strong></li> <li>æ‰§è¡Œ <code>yarn binary 1.39.2 { codeservername }</code> æ‰“åŒ…äºŒè¿›åˆ¶æ–‡ä»¶</li> <li>æ‰§è¡Œæ‰“åŒ…å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯è®¿é—®</li></ul> <h2 id="å…³é”®ä»£ç è§£æ"><a href="#å…³é”®ä»£ç è§£æ" class="header-anchor">#</a> å…³é”®ä»£ç è§£æ</h2> <h3 id="browsersocketfactory-ts"><a href="#browsersocketfactory-ts" class="header-anchor">#</a> browserSocketFactory.ts</h3> <p>è·¯å¾„ï¼š<a href="https://github.com/microsoft/vscode/tree/master/src/vs/base/" target="_blank" rel="noopener noreferrer">browserSocketFactory.ts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€ -- <code>BrowserWebSocket</code> ä¸‹çš„ <code>send</code> å‡½æ•°<br>
åŠŸèƒ½ï¼švscode å®¢æˆ·ç«¯å‘é€æ•°æ®çš„å‡ºå…¥å£<br>
åˆ†æï¼š</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">BrowserWebSocket</span> <span class="token keyword">extends</span> <span class="token class-name">Disposable</span> <span class="token keyword">implements</span> <span class="token class-name">IWebSocket</span> <span class="token punctuation">{</span>
	<span class="token comment">// è¿™é‡Œnewä¸€ä¸ªäº‹ä»¶è§¦å‘å™¨ï¼ŒåŒ…å«fireæ–¹æ³•</span>
	<span class="token comment">// The Emitter can be used to expose an Event to the public to fire it from the insides.</span>
	<span class="token comment">// å¼•ç”¨è‡ª event.ts çš„ Emitter ç±»</span>
	<span class="token comment">// è¿™é‡Œä¸»è¦æ˜¯æ³¨å†Œäº‹ä»¶ï¼Œå¹¶å­˜åœ¨ this._store ä¸­ this_store æ˜¯ DisposableStore å¯¹è±¡æ•°æ®</span>
	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _onData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emitter<span class="token operator">&lt;</span>ArrayBuffer<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">readonly</span> onData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_onData<span class="token punctuation">.</span>event

	<span class="token keyword">public</span> <span class="token keyword">readonly</span> onOpen<span class="token operator">:</span> Event<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>

	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _onClose <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Emitter<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">readonly</span> onClose <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_onClose<span class="token punctuation">.</span>event

	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _onError <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Emitter<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">readonly</span> onError <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_onError<span class="token punctuation">.</span>event

	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _socket<span class="token operator">:</span> WebSocket
	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _fileReader<span class="token operator">:</span> FileReader
	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _queue<span class="token operator">:</span> Blob<span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token keyword">private</span> _isReading<span class="token operator">:</span> <span class="token builtin">boolean</span>
	<span class="token keyword">private</span> _isClosed<span class="token operator">:</span> <span class="token builtin">boolean</span>

	<span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token function-variable function">_socketMessageListener</span><span class="token operator">:</span> <span class="token punctuation">(</span>ev<span class="token operator">:</span> MessageEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>

	<span class="token keyword">constructor</span><span class="token punctuation">(</span>socket<span class="token operator">:</span> WebSocket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket <span class="token operator">=</span> socket
		<span class="token keyword">this</span><span class="token punctuation">.</span>_fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_isReading <span class="token operator">=</span> <span class="token boolean">false</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_isClosed <span class="token operator">=</span> <span class="token boolean">false</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span>_fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_isReading <span class="token operator">=</span> <span class="token boolean">false</span>
			<span class="token keyword">const</span> buff <span class="token operator">=</span> <span class="token operator">&lt;</span>ArrayBuffer<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span>result
			<span class="token keyword">this</span><span class="token punctuation">.</span>_onData<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span>
			<span class="token comment">// å½“ queue è¿˜æœ‰æ•°æ®çš„æ—¶å€™ï¼Œç»§ç»­æ‰§è¡Œ</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_queue<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">const</span> <span class="token function-variable function">enqueue</span> <span class="token operator">=</span> <span class="token punctuation">(</span>blob<span class="token operator">:</span> Blob<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token comment">// è¿™é‡Œåšäº†ä¸ªç¼“å†²å¤„ç†ï¼Œå½“æ­£åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå°† Blob ç¼“å­˜åœ¨ queue ä¸­</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_isReading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_isReading <span class="token operator">=</span> <span class="token boolean">true</span>
			<span class="token comment">// è¿™é‡Œå°†æ”¶åˆ°çš„ Blob æ•°æ®è½¬æ¢æˆ ArrayBuffer</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_fileReader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">_socketMessageListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ev<span class="token operator">:</span> MessageEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Blob<span class="token operator">&gt;</span>ev<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// websocket çš„ message äº‹ä»¶ï¼Œæ¥æ”¶æœåŠ¡ç«¯ä¼ å›æ¥çš„æ•°æ®</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_socketMessageListener<span class="token punctuation">)</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span>onOpen <span class="token operator">=</span> Event<span class="token punctuation">.</span><span class="token function">fromDOMEventEmitter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">,</span> <span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span>

		<span class="token keyword">let</span> pendingErrorEvent<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span>

		<span class="token keyword">const</span> <span class="token function-variable function">sendPendingErrorNow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> err <span class="token operator">=</span> pendingErrorEvent
			pendingErrorEvent <span class="token operator">=</span> <span class="token keyword">null</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_onError<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">const</span> errorRunner <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RunOnceScheduler</span><span class="token punctuation">(</span>sendPendingErrorNow<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token keyword">const</span> <span class="token function-variable function">sendErrorSoon</span> <span class="token operator">=</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			errorRunner<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			pendingErrorEvent <span class="token operator">=</span> err
			errorRunner<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">const</span> <span class="token function-variable function">sendErrorNow</span> <span class="token operator">=</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			errorRunner<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			pendingErrorEvent <span class="token operator">=</span> err
			<span class="token function">sendPendingErrorNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_register</span><span class="token punctuation">(</span>
			dom<span class="token punctuation">.</span><span class="token function">addDisposableListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">,</span> <span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> CloseEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_isClosed <span class="token operator">=</span> <span class="token boolean">true</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>pendingErrorEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// The browser is offline =&gt; this is a temporary error which might resolve itself</span>
						<span class="token function">sendErrorNow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RemoteAuthorityResolverError</span><span class="token punctuation">(</span><span class="token string">&quot;Browser is offline&quot;</span><span class="token punctuation">,</span> RemoteAuthorityResolverErrorCode<span class="token punctuation">.</span>TemporarilyNotAvailable<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
						<span class="token comment">// An error event is pending</span>
						<span class="token comment">// The browser appears to be online...</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>wasClean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token comment">// Let's be optimistic and hope that perhaps the server could not be reached or something</span>
							<span class="token function">sendErrorNow</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RemoteAuthorityResolverError</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">WebSocket close with status code </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>e<span class="token punctuation">.</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> RemoteAuthorityResolverErrorCode<span class="token punctuation">.</span>TemporarilyNotAvailable<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
							<span class="token comment">// this was a clean close =&gt; send existing error</span>
							errorRunner<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
							<span class="token function">sendPendingErrorNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">this</span><span class="token punctuation">.</span>_onClose<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">)</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_register</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span><span class="token function">addDisposableListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> sendErrorSoon<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">send</span><span class="token punctuation">(</span>data<span class="token operator">:</span> ArrayBuffer <span class="token operator">|</span> ArrayBufferView<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_isClosed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Refuse to write data to closed WebSocket...</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_isClosed <span class="token operator">=</span> <span class="token boolean">true</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_socketMessageListener<span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div> <h3 id="ipc-net-ts"><a href="#ipc-net-ts" class="header-anchor">#</a> ipc.net.ts</h3> <p>è·¯å¾„ï¼š<a href="https://github.com/microsoft/vscode/tree/master/src/vs/base/parts/ipc/node/ipc.net.ts" target="_blank" rel="noopener noreferrer">ipc.net.ts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€ -- <code>WebSocketNodeSocket</code> ä¸‹çš„ <code>_acceptChunk</code> å‡½æ•°ï¼ˆ<code>this.socket.onData(data =&gt; this._acceptChunk(data))</code>ï¼‰<br>
åŠŸèƒ½ï¼šåˆæ­¥ç¡®è®¤æ˜¯æœåŠ¡ç«¯æ¥æ”¶ ws ä¼ è¾“çš„æ•°æ®ä¹‹åçš„å¤„ç†å‡½æ•°<br>
åˆ†æï¼š</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">private</span> <span class="token function">_acceptChunk</span><span class="token punctuation">(</span>data<span class="token operator">:</span> VSBuffer<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>byteLength <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span><span class="token function">acceptChunk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// å®šä¹‰çš„ chunkNum ç±»å‹æ•°æ®ï¼Œä»¥ VSBuffer[] å½¢å¼å­˜å‚¨æ‰€æœ‰æ¥æ”¶åˆ°çš„æ•°æ®</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// åªè¦ _incomingData çš„å­—èŠ‚é•¿åº¦å¤§äºæœ€å°å¤´éƒ¨é•¿åº¦ï¼ˆå³2ï¼‰æ—¶ï¼Œéå†è¯»æ•°æ®</span>
		<span class="token comment">// ä¸‹é¢çš„åˆ¤æ–­æ¡ä»¶æ˜¯ä¸ºäº†é™åˆ¶è¯»å–é¡ºåºï¼šç¡®è®¤å¤´éƒ¨ä¿¡æ¯-&gt; æå–å¤´éƒ¨ä¿¡æ¯ -&gt; æå–dataæ•°æ®</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">===</span> ReadState<span class="token punctuation">.</span>PeekHeader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// chunkNum ç±»å‹æ–¹æ³•ï¼Œpeek æ˜¯è¯»å–æ•°æ®çš„æ–¹æ³•ï¼Œå¼€å§‹è¯»å–æœ€å°å¤´éƒ¨é•¿åº¦çš„æ•°æ®ï¼ˆè¯»2ä½æ•°æ®ï¼‰</span>
			<span class="token keyword">const</span> peekHeader <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// secondByte ä¸ºç¬¬äºŒå­—èŠ‚æ•°æ®ï¼ŒreadUInt8 æ˜¯æŒ‡è¯»å–ç¬¬ offset ä½çš„æ— ç¬¦å·çš„8ä½æ•´æ•°å€¼</span>
			<span class="token comment">// å¯ä»¥å‚è€ƒnodejs apiä¸­æ–‡æ–‡æ¡£ï¼šhttp://nodejs.cn/api/buffer.html</span>
			<span class="token keyword">const</span> secondByte <span class="token operator">=</span> peekHeader<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// å°†ç¬¬äºŒå­—èŠ‚æ•°æ®ï¼ˆæœ€å¤§ä¸º255ï¼‰ä¸ 0b10000000 åš â€˜ä¸â€™ çš„æ“ä½œï¼Œç„¶åå³ç§»ä¸ƒä½å¾—åˆ°ä¸€ä¸ª â€˜æ ‡å¿—æ•°å­—â€™</span>
			<span class="token comment">// è¿™ä¸ªæ ‡å¿—æ•°å­—ä¸ºmaskï¼Œä¹Ÿå°±æ˜¯ websocket ä¸­çš„æ©ç ï¼Œä¸»è¦é’ˆå¯¹å®‰å…¨æ–¹é¢çš„ä¼˜åŒ–ï¼Œé¿å…è¢«ä¸­é—´è®¾å¤‡æ”»å‡»</span>
			<span class="token comment">// è¿™ä¸€é¡¹ä»…å¯ä»¥åœ¨å®¢æˆ·ç«¯è®¾ç½®ï¼Œå¦‚æœåœ¨æœåŠ¡ç«¯è®¾ç½®äº†ä¼šæŠ¥é”™ï¼šåªæœ‰å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æ‰éœ€è¦æ©ç å¤„ç†</span>
			<span class="token keyword">const</span> hasMask <span class="token operator">=</span> <span class="token punctuation">(</span>secondByte <span class="token operator">&amp;</span> <span class="token number">0b10000000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">7</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> len <span class="token operator">=</span> <span class="token punctuation">(</span>secondByte <span class="token operator">&amp;</span> <span class="token number">0b01111111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// æ‰‹åŠ¨è°ƒæ•´ _state çš„æ•°æ®ï¼Œä½¿è¿›å…¥ä¸‹ä¸€ä¸ªé€»è¾‘åˆ¤æ–­</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">=</span> ReadState<span class="token punctuation">.</span>ReadHeader<span class="token punctuation">;</span>
			<span class="token comment">// è®¡ç®—ä¸‹ä¸€æ­¥è¯»å–æ•°æ®çš„é•¿åº¦</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen <span class="token operator">=</span> Constants<span class="token punctuation">.</span>MinHeaderByteSize <span class="token operator">+</span> <span class="token punctuation">(</span>hasMask <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">126</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">127</span> <span class="token operator">?</span> <span class="token number">8</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>mask <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">===</span> ReadState<span class="token punctuation">.</span>ReadHeader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// read entire header</span>
			<span class="token comment">// read æ–¹æ³•ä¼šä¿®æ”¹æºæ•°æ®ï¼šå–å‡º chunksï¼ˆVSBuffer[]ï¼‰ ä¸­çš„ç¬¬ä¸€é¡¹æ•°æ® - shift()</span>
			<span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> secondByte <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> hasMask <span class="token operator">=</span> <span class="token punctuation">(</span>secondByte <span class="token operator">&amp;</span> <span class="token number">0b10000000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">7</span><span class="token punctuation">;</span>
			<span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token punctuation">(</span>secondByte <span class="token operator">&amp;</span> <span class="token number">0b01111111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token comment">// 2 ** 8 æ˜¯è®¡ç®—2çš„næ¬¡æ–¹</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// è¯»å–headerç¬¬äºŒå­—èŠ‚çš„æ•°å­—,ç„¶åå† * 2 ** 8 + ç¬¬ä¸‰å­—èŠ‚çš„æ•°å­—ï¼Œè®¡ç®—å‡ºé•¿åº¦len</span>
				len <span class="token operator">=</span> <span class="token punctuation">(</span>
					header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">8</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span>
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">127</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// åŒä¸Š</span>
				len <span class="token operator">=</span> <span class="token punctuation">(</span>
					header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">24</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">16</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">8</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span>
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">let</span> mask <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>hasMask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// è®¡ç®—å®Œlenä¹‹åï¼Œoffseté€’å¢ï¼Œå†è®¡ç®—mask</span>
				mask <span class="token operator">=</span> <span class="token punctuation">(</span>
					header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">24</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">16</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">8</span>
					<span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span>
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// è¿™é‡ŒåŒæ ·è®¾ç½®ä¸€ä¸ªå®šå€¼ï¼Œç”¨äºä¸‹ä¸€æ­¥çš„é€»è¾‘åˆ¤æ–­ï¼Œä½¿ä¹‹è¿›å…¥ä¸‹ä¸€é˜¶æ®µå¤„ç†</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">=</span> ReadState<span class="token punctuation">.</span>ReadBody<span class="token punctuation">;</span>
			<span class="token comment">// å­˜å‚¨ä¸‹ä¸€æ­¥è¯»å–æ•°æ®çš„é•¿åº¦</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen <span class="token operator">=</span> len<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>mask <span class="token operator">=</span> mask<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">===</span> ReadState<span class="token punctuation">.</span>ReadBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// åŒæ ·æ˜¯ shift() æ•°ç»„ä¸­çš„ç¬¬ä¸€é¡¹å­˜å‚¨åœ¨ body</span>
			<span class="token comment">// åˆ°è¿™é‡Œçš„ VSBuffer è¿˜ä¸æ˜¯æœ€ç»ˆçš„å¯ä»¥è½¬æ¢çš„æ•°æ®</span>
			<span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// è¿™é‡Œæ‰§è¡Œ unmaskæ–¹æ³•ï¼Œæœ€ç»ˆçš„æ•°æ®åœ¨è¿™ä¸ªæ–¹æ³•ä½“å¯ä»¥æ‹¿åˆ°</span>
			<span class="token function">unmask</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// æ¢å¤ _state ä¸ºå¼€å§‹çš„æ•°æ®ï¼Œé‡æ–°å¼€å§‹æ–°ä¸€è½®æ•°æ®çš„å¤„ç†</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">=</span> ReadState<span class="token punctuation">.</span>PeekHeader<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen <span class="token operator">=</span> Constants<span class="token punctuation">.</span>MinHeaderByteSize<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>mask <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token comment">// TODO: fireçš„ä½œç”¨ï¼Ÿç±»ä¼¼è§¦å‘æ‰€æœ‰å…³è”äº‹ä»¶ï¼Ÿ</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_onData<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½ç½®ï¼šWebSocketNodeSocket ç±»</span>
<span class="token keyword">private</span> <span class="token keyword">readonly</span> _state <span class="token operator">=</span> <span class="token punctuation">{</span>
	state<span class="token operator">:</span> ReadState<span class="token punctuation">.</span>PeekHeader<span class="token punctuation">,</span>	<span class="token comment">// eNumç±»å‹æ•°æ®</span>
	readLen<span class="token operator">:</span> Constants<span class="token punctuation">.</span>MinHeaderByteSize<span class="token punctuation">,</span>	<span class="token comment">// æœ€å°å¤´éƒ¨é•¿åº¦</span>
	mask<span class="token operator">:</span> <span class="token number">0</span>	<span class="token comment">// æ ‡å¿—ä½</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ChunkStream class</span>
<span class="token comment">// ä½ç½®ï¼š https://github.com/microsoft/vscode/tree/master/src/vs/base/parts/ipc/common/ipc.net.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChunkStream</span> <span class="token punctuation">{</span>
	<span class="token comment">// ç›¸å½“äº Buffer æ•°ç»„</span>
	<span class="token keyword">private</span> _chunks<span class="token operator">:</span> VSBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token comment">// å­—èŠ‚é•¿åº¦</span>
	<span class="token keyword">private</span> _totalLength<span class="token operator">:</span> <span class="token builtin">number</span>

	<span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">byteLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// è·å–å­—èŠ‚é•¿åº¦</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength
	<span class="token punctuation">}</span>

	<span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">acceptChunk</span><span class="token punctuation">(</span>buff<span class="token operator">:</span> VSBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ç¼“å†²æ¥æ”¶åˆ°çš„ bufferï¼Œå­˜åœ¨æ•°ç»„é‡Œ _chunks</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">+=</span> buff<span class="token punctuation">.</span>byteLength
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">read</span><span class="token punctuation">(</span>byteCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> VSBuffer <span class="token punctuation">{</span>
		<span class="token comment">// è¯»å–å¹¶æˆªå–ç¬¬ä¸€é¡¹æ•°æ®ï¼Œä¼šæ”¹å˜æº Buffer</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_read</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">peek</span><span class="token punctuation">(</span>byteCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> VSBuffer <span class="token punctuation">{</span>
		<span class="token comment">// ä»…è¯»å–ç¬¬ä¸€é¡¹æ•°æ®ï¼Œä¸æ”¹å˜æº Buffer</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_read</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token function">_read</span><span class="token punctuation">(</span>byteCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> advance<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> VSBuffer <span class="token punctuation">{</span>
		<span class="token comment">// å®é™…æ‰§è¡Œè¯»å–æ“ä½œçš„å‡½æ•°ï¼Œæ ¹æ®å­—èŠ‚é•¿åº¦åŒºåˆ†ä¸åŒå¤„ç†æ–¹æ³•</span>
		<span class="token comment">// å…ˆå¤„ç†è¾¹ç•Œæƒ…å†µ</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>byteCount <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">getEmptyBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>byteCount <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// å°†è¯»å–çš„é•¿åº¦è¶…è¿‡æ€»é•¿ï¼Œä¼šæŠ¥é”™</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot read so many bytes!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>byteLength <span class="token operator">===</span> byteCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// super fast path, precisely first chunk must be returned</span>
			<span class="token comment">// å–ç¬¬ä¸€é¡¹æ•°æ®</span>
			<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>advance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// shift æ‰ç¬¬ä¸€é¡¹æ•°æ®</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token comment">// åŒæ—¶ä¿®æ”¹æ€»é•¿</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">-=</span> byteCount
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> result
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>byteLength <span class="token operator">&gt;</span> byteCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// fast path, the reading is entirely within the first chunk</span>
			<span class="token comment">// å¦‚æœç¬¬ä¸€é¡¹æ•°æ®é•¿åº¦è¶…è¿‡è¦è¯»å–çš„å­—èŠ‚é•¿åº¦ï¼Œé‚£ä¹ˆåªéœ€è¦è¯» byteCount é•¿åº¦çš„æ•°æ®</span>
			<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> byteCount<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>advance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">)</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">-=</span> byteCount
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> result
		<span class="token punctuation">}</span>

		<span class="token comment">// VSBuffer.alloc: åˆ›å»º byteCount é•¿çš„ Buffer æ•°æ®ï¼Œå¹¶åˆå§‹åŒ–æ¯ä¸€é¡¹ä¸º0</span>
		<span class="token comment">// TODO: ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæ‰§è¡Œä¸‹é¢ä»£ç ï¼Ÿ</span>
		<span class="token keyword">let</span> result <span class="token operator">=</span> VSBuffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">)</span>
		<span class="token keyword">let</span> resultOffset <span class="token operator">=</span> <span class="token number">0</span>
		<span class="token keyword">let</span> chunkIndex <span class="token operator">=</span> <span class="token number">0</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>byteCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// ä¾æ—§æ˜¯å–ç¬¬ä¸€é¡¹æ•°æ®</span>
			<span class="token keyword">const</span> chunk <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span>chunkIndex<span class="token punctuation">]</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;</span> byteCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// this chunk will survive</span>
				<span class="token keyword">const</span> chunkPart <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> byteCount<span class="token punctuation">)</span>
				<span class="token comment">// resultè¿™é‡Œè°ƒç”¨setæ–¹æ³•ï¼Œå®é™…æ˜¯è°ƒç”¨ Uint8Array çš„ set æ–¹æ³•ã€‚åœ¨ VSBuffer å†…è¿˜æ˜¯ç”¨çš„ Uint8Array ç±»å‹æ•°æ®</span>
				<span class="token comment">// å‚è€ƒï¼šhttps://github.com/microsoft/vscode/tree/master/src/vs/base/common/buffer.ts ä¸­çš„ Buffer ç±»</span>
				result<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>chunkPart<span class="token punctuation">,</span> resultOffset<span class="token punctuation">)</span>
				resultOffset <span class="token operator">+=</span> byteCount

				<span class="token keyword">if</span> <span class="token punctuation">(</span>advance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// è¿™é‡Œè¿›è¡Œä¸€æ¬¡è£å‰ªï¼Œè¶…è¿‡byteCounté•¿åº¦çš„éƒ½è¢«è£æ‰</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span>chunkIndex<span class="token punctuation">]</span> <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">)</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">-=</span> byteCount
				<span class="token punctuation">}</span>

				byteCount <span class="token operator">-=</span> byteCount
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// è¿™é‡Œçš„å¤„ç† åŒä¸Š</span>
				<span class="token comment">// this chunk will be entirely read</span>
				result<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> resultOffset<span class="token punctuation">)</span>
				resultOffset <span class="token operator">+=</span> chunk<span class="token punctuation">.</span>byteLength

				<span class="token keyword">if</span> <span class="token punctuation">(</span>advance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">-=</span> chunk<span class="token punctuation">.</span>byteLength
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					chunkIndex<span class="token operator">++</span>
				<span class="token punctuation">}</span>

				byteCount <span class="token operator">-=</span> chunk<span class="token punctuation">.</span>byteLength
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// æ³¨æ„è¿™é‡Œè¿”å›çš„å°±æ˜¯ VSBuffer æ ¼å¼æ•°æ®ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ toString æ–¹æ³• decode</span>
		<span class="token keyword">return</span> result
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è·¯å¾„ï¼š<a href="https://github.com/microsoft/vscode/tree/master/src/vs/base/parts/ipc/node/ipc.net.ts" target="_blank" rel="noopener noreferrer">ipc.net.ts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€ -- <code>WebSocketNodeSocket</code> ä¸‹çš„ <code>write</code> å‡½æ•°<br>
åŠŸèƒ½ï¼šåˆæ­¥ç¡®è®¤æ˜¯æœåŠ¡ç«¯å‘é€ ws çš„å‡½æ•°<br>
åˆ†æï¼š</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// class WebSocketNodeSocket</span>
<span class="token keyword">public</span> <span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token operator">:</span> VSBuffer<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
	<span class="token comment">// åˆå§‹åŒ– headerLen ä¸ºæœ€å°å¤´éƒ¨é•¿åº¦</span>
	<span class="token keyword">let</span> headerLen <span class="token operator">=</span> Constants<span class="token punctuation">.</span>MinHeaderByteSize<span class="token punctuation">;</span>
	<span class="token comment">// æ ¹æ®å­—èŠ‚é•¿åº¦ï¼Œç¡®å®š headerLen çš„å¤§å°</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&lt;</span> <span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		headerLen <span class="token operator">+=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		headerLen <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		headerLen <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// åˆ›å»º headerLen é•¿åº¦çš„å­—èŠ‚åºåˆ—</span>
	<span class="token keyword">const</span> header <span class="token operator">=</span> VSBuffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span>headerLen<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ç¬¬ä¸€ä½æ— ç¬¦å·æ•´æ•°ä¿®æ”¹ä¸º 0b10000010</span>
	header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0b10000010</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&lt;</span> <span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// è¿™é‡Œè¿”å›çš„æ•°æ®æ—¶ VSBufferï¼Œä½†å®é™…ä¸Šå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„æ˜¯ MessageEvent æ ¼å¼æ•°æ®ï¼ŒåŒ…å«å…¶ä»–å¦‚ï¼šwsæ¥æºä¿¡æ¯ç­‰</span>
	<span class="token comment">// æ•°æ®éƒ½å­˜åœ¨ e.data å†…ï¼Œå¹¶ä¸” MessageEvent çš„æ ¼å¼ä¸º Blob æ•°æ®</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>VSBuffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>header<span class="token punctuation">,</span> buffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="è¸©è¿‡çš„æ— åº•æ´-ğŸ•³"><a href="#è¸©è¿‡çš„æ— åº•æ´-ğŸ•³" class="header-anchor">#</a> è¸©è¿‡çš„æ— åº•æ´ ğŸ•³</h2> <ul><li>ä¿®æ”¹çš„æºç è¦ç¡®ä¿ä¸èƒ½å‡ºç°é”™è¯¯å¦‚ï¼š tslint æç¤ºè¯­æ³•é”™è¯¯çš„ä»£ç ç­‰</li> <li>æ‰“åŒ…çš„ patch æ–‡ä»¶ä¸€å®šè¦æ³¨æ„ï¼Œç¼–ç æ˜¯ <strong><code>UTF-8</code></strong>ï¼Œä¸”æ¢è¡Œç¬¦çš„æ ¼å¼æ˜¯ï¼š<strong><code>LF</code></strong>ï¼ˆé»˜è®¤æ˜¯<code>CRLF</code>ï¼‰</li> <li>å¦‚æœé‡åˆ° patch å¤±è´¥é—®é¢˜ï¼Œå¯ä»¥å…ˆè¯•è¯•æ¸…é™¤æœåŠ¡å™¨çš„ç¼“å­˜ï¼ˆé‡æ–° clone é¡¹ç›®ä»£ç ï¼‰ï¼Œç„¶åå†é‡æ–°æ‰§è¡Œ <code>yarn build</code></li> <li>æ³¨æ„ vscode å†…éƒ¨åŒæ—¶æœ‰ window ç¯å¢ƒå’Œ node ç¯å¢ƒï¼Œè¦æ³¨æ„ä½¿ç”¨å±æ€§çš„å…¼å®¹æ€§ï¼Œé¿å…æŠ¥é”™</li> <li>è¿è¡Œè¿‡ç¨‹ä¸­æœ‰æ—¶ä¼šä¸€ç›´é‡è¿ï¼Œç„¶åçªç„¶å´©æºƒå°±ä¸€ç›´è¿ä¸ä¸Šï¼Œå…·ä½“ä»€ä¹ˆåŸå› ä¸æ¸…æ¥š</li> <li><code>trailing whitespace</code> æŠ¥é”™æ˜¯æŒ‡ï¼Œä»£ç æœ€åä¸€ä¸ªå­—ç¬¦å¿…é¡»ä»¥ ';' ç»“å°¾ï¼Œå¦åˆ™ä¼šæŠ¥é”™</li></ul> <h2 id="çŒœæµ‹"><a href="#çŒœæµ‹" class="header-anchor">#</a> çŒœæµ‹</h2> <ul><li><code>code-server</code> åŸºæœ¬ä¾èµ–éƒ½æ˜¯åœ¨ <code>vscode</code> ä¸Šï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°çš„ <code>source</code> æ¿å—æ˜¯æœä¸åˆ°ä»»ä½• <code>code-server</code> ç›®å½•ä¸‹çš„ç›¸å…³ä»£ç ï¼Œåªæœ‰å­˜åœ¨äº <code>vscode</code> çš„æ‰èƒ½æœåˆ°</li> <li><code>vscode</code> çš„ <code>websocket</code> å‘é€æ•°æ®æ–¹æ³•åœ¨ <code>browserSocketFactory.ts</code> çš„ <code>send</code> æ–¹æ³•ï¼Œå¯ä»¥ <code>console.log</code> æ‰“å°åˆ°æ§åˆ¶å°çœ‹çœ‹ã€‚å¯ä»¥ç”¨ <code>TextDecoder</code> å»è§£ç æ•°æ®ï¼Œæ•°æ®çš„åŠ å¯†ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œå¤„ç†</li> <li><code>vscode</code> çš„ <code>websocket</code> æ¥æ”¶æ•°æ®æ–¹æ³•åœ¨ <code>browserSocketFactory.ts</code> çš„ <code>_socketMessageListener</code> æ–¹æ³•ï¼Œå‚æ•° <code>ev</code> æ˜¯ <code>Blob</code> æ ¼å¼å†…å®¹ï¼Œå¹¶ä¸”è¿™é‡Œæ˜¯æœ€å…ˆæ¥æ”¶åˆ° <code>code-server</code> è¿”å›çš„å†…å®¹ï¼Œå¯ä»¥åœ¨è¿™é‡Œè§£å¯†</li> <li><code>ipc</code> æ˜¯è¿›ç¨‹ä¹‹é—´çš„äº¤äº’æ–¹å¼ï¼Œ</li> <li>ä¸¤ä¸ª <code>websocket</code> ä¸­ç¬¬ä¸€ä¸ªä¸»è¦æ˜¯æ•°æ®äº¤äº’ï¼Œç¬¬äºŒä¸ªä¸»è¦æ˜¯ç”¨äºå¿ƒè·³æ£€æµ‹</li> <li><code>buffer.ts</code> ä¸­å®šä¹‰äº†ä¸€ä¸ª <code>hasBuffer</code> å˜é‡ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦æœ‰ <code>Buffer</code> å¯¹è±¡ã€‚ï¼ˆæµè§ˆå™¨ä¸‹ä¸º<code>undefined</code>ï¼‰ï¼Œç„¶åå¯¹æ•°æ®çš„æ ¼å¼è¿›è¡Œå¯¹åº”çš„æ”¹å˜ã€‚åœ¨<code>node</code>ç¯å¢ƒä¸‹ç”¨<code>Buffer</code>ï¼Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ä½¿ç”¨<code>TextDecoder</code></li></ul> <h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="header-anchor">#</a> å…¶ä»–</h2> <ul><li>ä¸‹é¢åº”è¯¥æ˜¯ <code>ipc</code> ä¹‹é—´äº¤äº’çš„æ•°æ®æŠ¥æ–‡æ ¼å¼</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * A message has the following format:
 * ```
 *     /-------------------------------|------\
 *     |             HEADER            |      |
 *     |-------------------------------| DATA |
 *     | TYPE | ID | ACK | DATA_LENGTH |      |
 *     \-------------------------------|------/
 * ```
 * The header is 9 bytes and consists of:
 *  - TYPE is 1 byte (ProtocolMessageType) - the message type
 *  - ID is 4 bytes (u32be) - the message id (can be 0 to indicate to be ignored)
 *  - ACK is 4 bytes (u32be) - the acknowledged message id (can be 0 to indicate to be ignored)
 *  - DATA_LENGTH is 4 bytes (u32be) - the length in bytes of DATA
 *
 * Only Regular messages are counted, other messages are not counted, nor acknowledged.
 */</span>
</code></pre></div><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="header-anchor">#</a> å‚è€ƒæ–‡æ¡£</h2> <ul><li><a href="https://juejin.cn/post/6844904024005672968" target="_blank" rel="noopener noreferrer">code-server æ˜¯å¦‚ä½•æŠŠ vscode æ¬åˆ°æµè§ˆå™¨çš„<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://github.com/microsoft/vscode" target="_blank" rel="noopener noreferrer">vscode<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://github.com/cdr/code-server" target="_blank" rel="noopener noreferrer">code-server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="http://nodejs.cn/api/" target="_blank" rel="noopener noreferrer">nodeJS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://zh.javascript.info/arraybuffer-binary-arrays" target="_blank" rel="noopener noreferrer">ArrayBuffer &amp; TypedArray<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener noreferrer">Blob<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Real102/Blog/edit/master/docs/blog/others/ws-in-vscode.md" target="_blank" rel="noopener noreferrer">Edit in GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/18/2020, 7:54:54 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/Blog/blog/others/vscode-for-web.html" class="prev">
        æ­å»º web ç‰ˆ vs code
      </a></span> <span class="next"><a href="/Blog/blog/others/format-phone.html">
        æ‰‹æœºå·è¾“å…¥æ¡†çš„æ ¼å¼åŒ–æ˜¾ç¤º
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Blog/assets/js/app.389f9714.js" defer></script><script src="/Blog/assets/js/2.35933c35.js" defer></script><script src="/Blog/assets/js/23.ad5e4d4c.js" defer></script>
  </body>
</html>
