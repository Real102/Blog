<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>æŠ€æœ¯åˆ†äº«--vscode ä¸­ websocket çš„ç ”ç©¶ | WolfBerry</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="WolfBerry's Blob">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.b177aafa.css" as="style"><link rel="preload" href="/Blog/assets/js/app.48336645.js" as="script"><link rel="preload" href="/Blog/assets/js/2.66b2721a.js" as="script"><link rel="preload" href="/Blog/assets/js/22.487da7c4.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.606e9ac2.js"><link rel="prefetch" href="/Blog/assets/js/11.51538e47.js"><link rel="prefetch" href="/Blog/assets/js/12.cd5a3438.js"><link rel="prefetch" href="/Blog/assets/js/13.76ffcb8a.js"><link rel="prefetch" href="/Blog/assets/js/14.9d6ca61a.js"><link rel="prefetch" href="/Blog/assets/js/15.15ba1d49.js"><link rel="prefetch" href="/Blog/assets/js/16.285d654c.js"><link rel="prefetch" href="/Blog/assets/js/17.b9f8ae24.js"><link rel="prefetch" href="/Blog/assets/js/18.9f402ed8.js"><link rel="prefetch" href="/Blog/assets/js/19.234ff861.js"><link rel="prefetch" href="/Blog/assets/js/20.d24e026e.js"><link rel="prefetch" href="/Blog/assets/js/21.c2aaedaa.js"><link rel="prefetch" href="/Blog/assets/js/23.95bf2664.js"><link rel="prefetch" href="/Blog/assets/js/3.ef470b3b.js"><link rel="prefetch" href="/Blog/assets/js/4.8883d23c.js"><link rel="prefetch" href="/Blog/assets/js/5.eb31eba8.js"><link rel="prefetch" href="/Blog/assets/js/6.cc18be44.js"><link rel="prefetch" href="/Blog/assets/js/7.d23bb2c1.js"><link rel="prefetch" href="/Blog/assets/js/8.668104e8.js"><link rel="prefetch" href="/Blog/assets/js/9.7a608a59.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.b177aafa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">WolfBerry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Blog/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/Blog/demo/" class="nav-link router-link-active">
  Demo
</a></div> <a href="https://github.com/Real102/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Blog/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/Blog/demo/" class="nav-link router-link-active">
  Demo
</a></div> <a href="https://github.com/Real102/Blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Demo</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/demo/" aria-current="page" class="sidebar-link">ä»‹ç»</a></li><li><a href="/Blog/demo/page1.html" aria-current="page" class="active sidebar-link">vscode ä¸­ websocket çš„ç ”ç©¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/demo/page1.html#å…¥å¸­" class="sidebar-link">å…¥å¸­</a></li><li class="sidebar-sub-header"><a href="/Blog/demo/page1.html#å¼€èƒƒèœ" class="sidebar-link">å¼€èƒƒèœ</a></li><li class="sidebar-sub-header"><a href="/Blog/demo/page1.html#ä¸»é£Ÿ" class="sidebar-link">ä¸»é£Ÿ</a></li><li class="sidebar-sub-header"><a href="/Blog/demo/page1.html#é¥­åç”œç‚¹" class="sidebar-link">é¥­åç”œç‚¹</a></li><li class="sidebar-sub-header"><a href="/Blog/demo/page1.html#ç¦»å¸­" class="sidebar-link">ç¦»å¸­</a></li></ul></li><li><a href="/Blog/demo/page2.html" class="sidebar-link">æ•°æ®ç±»å‹ä¸è½¬æ¢</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="æŠ€æœ¯åˆ†äº«-vscode-ä¸­-websocket-çš„ç ”ç©¶"><a href="#æŠ€æœ¯åˆ†äº«-vscode-ä¸­-websocket-çš„ç ”ç©¶" class="header-anchor">#</a> æŠ€æœ¯åˆ†äº«--vscode ä¸­ websocket çš„ç ”ç©¶</h1> <h2 id="å…¥å¸­"><a href="#å…¥å¸­" class="header-anchor">#</a> å…¥å¸­</h2> <ul><li>é¦–å…ˆå…ˆæ¼”ç¤ºä¸€é vscode é¡µé¢ï¼ŒåŠ websocket æ•°æ®äº¤äº’æ¼”ç¤ºã€‚ç«ç‹æµè§ˆå™¨ä¸‹å¯ä»¥çœ‹åˆ° websocket ä¼ è¾“çš„å…·ä½“å†…å®¹ï¼ˆæ˜æ–‡ï¼‰</li> <li>å› ä¸ºæœ‰æŠ“åŒ…å·¥å…·çš„å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡æŠ“åŒ…çš„æ–¹å¼çœ‹åˆ° websocket ä¼ è¾“çš„æ•°æ®ï¼Œå› æ­¤éœ€è¦åœ¨è¿™é‡Œå¢åŠ ä¸€å±‚åŠ å¯†</li> <li>code-server ç›¸å½“äº vscode çš„æœåŠ¡ç«¯ï¼Œå½“æœ¬åœ°ä¿®æ”¹æ–‡ä»¶æˆ–æ‰§è¡Œå…¶ä»–æ“ä½œæ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿ vscode è·Ÿ code-server çš„æ•°æ®äº¤äº’ï¼Œå¹¶ä¸” vscode ä¼šåŒæ—¶åœ¨ browser å’Œ node ç¯å¢ƒä¸‹è¿è¡Œ</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>microsoft<span class="token operator">/</span>vscode
cd vscode
git checkout $<span class="token punctuation">{</span>vscodeVersion<span class="token punctuation">}</span> <span class="token comment">// æˆ‘ä»¬ç›®å‰ç”¨çš„æ˜¯ 1.39.2 ç‰ˆæœ¬ï¼Œå¯¹åº” code-server æ˜¯ 2.1692-vsc1.39.2</span>
yarn	<span class="token comment">// å®‰è£…ä¾èµ–</span>
<span class="token keyword">export</span> <span class="token constant">OUT</span><span class="token operator">=</span><span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>output<span class="token operator">/</span>build	<span class="token comment">// æŒ‡å®šè¾“å‡ºè·¯å¾„</span>
yarn build $<span class="token punctuation">{</span>vscodeVersion<span class="token punctuation">}</span> $<span class="token punctuation">{</span>codeServerVersion<span class="token punctuation">}</span>	<span class="token comment">// æ‰§è¡Œæ‰“åŒ…ï¼Œç¬¬ä¸€ä¸ªæ˜¯ vscode ç‰ˆæœ¬ï¼Œè¿™é‡Œå†™1.39.2ï¼Œç¬¬äºŒä¸ªæ˜¯æ‰“åŒ…å code-server çš„åå­—ï¼Œè¿™é‡Œå¯ä»¥éšæ„å¡«å†™</span>
node <span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>output<span class="token operator">/</span>build<span class="token operator">/</span>out<span class="token operator">/</span>vs<span class="token operator">/</span>server<span class="token operator">/</span>main<span class="token punctuation">.</span>js	<span class="token comment">// æ‰§è¡Œnodeå‘½ä»¤ï¼Œå°±å¯ä»¥è·‘èµ·æ¥äº†</span>
yarn binary $<span class="token punctuation">{</span>vscodeVersion<span class="token punctuation">}</span> $<span class="token punctuation">{</span>codeServerVersion<span class="token punctuation">}</span>	<span class="token comment">// ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶</span>
</code></pre></div><h2 id="å¼€èƒƒèœ"><a href="#å¼€èƒƒèœ" class="header-anchor">#</a> å¼€èƒƒèœ</h2> <h3 id="buffer-ã€-arraybuffer-ã€-typedarray-ã€-blob"><a href="#buffer-ã€-arraybuffer-ã€-typedarray-ã€-blob" class="header-anchor">#</a> Buffer ã€ ArrayBuffer ã€ TypedArray ã€ Blob</h3> <ul><li><code>Buffer</code> æ˜¯ <code>node</code> ç¯å¢ƒä¸‹çš„ç¼“å†²å™¨ï¼Œç”¨äºè¡¨ç¤ºå›ºå®šé•¿åº¦çš„å­—èŠ‚åºåˆ—ï¼ˆ<code>Buffer.from() | Buffer.alloc()</code>ï¼‰ï¼Œå¹¶ä¸” <code>Buffer</code> æ˜¯ <code>JavaScript</code> çš„ <code>Uint8Array</code> ç±»çš„å­ç±»ï¼Œå¯ç”¨ <code>toString()</code> æ–¹æ³•è½¬æˆå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šç¼–ç æ ¼å¼</li> <li><code>ArrayBuffer</code> æ˜¯ç”¨æ¥è¡¨ç¤ºé€šç”¨çš„ã€å›ºå®šé•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®ç¼“å†²åŒºï¼ˆæ˜¯æµè§ˆå™¨ç¯å¢ƒä¸‹çš„äºŒè¿›åˆ¶/å­—èŠ‚æ•°ç»„ï¼Œæ˜¯å¯¹å›ºå®šé•¿åº¦çš„è¿ç»­å†…å­˜ç©ºé—´çš„å¼•ç”¨ï¼‰ã€‚<code>ArrayBuffer</code> å¯ä»¥é€šè¿‡æ„é€ å‡½æ•° <code>new ArrayBuffer(length)</code> åˆ›å»ºï¼Œä¸€æ—¦åˆ›å»ºä¹‹åå°±ä¸èƒ½å†ä¿®æ”¹é•¿åº¦ã€‚å¯ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/TextDecoder" target="_blank" rel="noopener noreferrer">TextDecoder<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€ æ„é€ å‡½æ•°è§£ææˆå­—ç¬¦ä¸²</li> <li><code>TypedArray</code> ç§°ä¸ºç±»å‹åŒ–æ•°ç»„ï¼Œç”¨äºæè¿° <code>ArrayBuffer</code> çš„ä¸€ä¸ªç±»æ•°ç»„è§†å›¾ï¼ˆ<code>Uint8Arrayã€Uint32Array</code>ï¼‰ï¼Œæ˜¯æ“ä½œ <code>ArrayBuffer</code> çš„ä¸»è¦é€”å¾„ã€‚</li> <li><code>Blob</code> è¡¨ç¤ºä¸€ä¸ªä¸å¯å˜ã€åŸå§‹æ•°æ®çš„ç±»æ–‡ä»¶å¯¹è±¡ï¼Œå®ƒçš„æ•°æ®å¯ä»¥æŒ‰æ–‡æœ¬æˆ–äºŒè¿›åˆ¶çš„æ ¼å¼è¿›è¡Œè¯»å–ï¼Œä¹Ÿå¯ä»¥è½¬æ¢æˆ ReadableStream æ¥ç”¨äºæ•°æ®æ“ä½œã€‚å¯ä»¥é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader" target="_blank" rel="noopener noreferrer">FileReader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€ è½¬æ¢æˆæŒ‡å®šæ ¼å¼</li></ul> <h3 id="æŒ‰ä½æ“ä½œç¬¦"><a href="#æŒ‰ä½æ“ä½œç¬¦" class="header-anchor">#</a> æŒ‰ä½æ“ä½œç¬¦</h3> <ul><li>æŒ‰ä½æ“ä½œç¬¦å°†å…¶æ“ä½œæ•°å½“ä½œ 32 ä½çš„æ¯”ç‰¹åºåˆ—ï¼ˆç”± 0 å’Œ 1 ç»„æˆï¼‰</li></ul> <table><thead><tr><th>è¿ç®—ç¬¦</th> <th>ç”¨æ³•</th> <th>æè¿°</th></tr></thead> <tbody><tr><td>æŒ‰ä½ä¸</td> <td>a &amp; b</td> <td>åªæœ‰ä¸¤ä¸ªæ“ä½œæ•°ç›¸åº”çš„æ¯”ç‰¹ä½éƒ½æ˜¯ 1 æ—¶ï¼Œç»“æœæ‰ä¸º 1ï¼Œå¦åˆ™ä¸º 0</td></tr> <tr><td>æŒ‰ä½æˆ–</td> <td>a | b</td> <td>å½“ä¸¤ä¸ªæ“ä½œæ•°ç›¸åº”çš„æ¯”ç‰¹ä½è‡³å°‘æœ‰ä¸€ä¸ª 1 æ—¶ï¼Œç»“æœä¸º 1ï¼Œå¦åˆ™ä¸º 0</td></tr> <tr><td>æŒ‰ä½å¼‚æˆ–</td> <td>a ^ b</td> <td>å½“ä¸¤ä¸ªæ“ä½œæ•°ç›¸åº”çš„æ¯”ç‰¹ä½æœ‰ä¸”åªæœ‰ä¸€ä¸ª 1 æ—¶ï¼Œç»“æœä¸º 1ï¼Œå¦åˆ™ä¸º 0</td></tr> <tr><td>æŒ‰ä½é</td> <td>~a</td> <td>åè½¬æ“ä½œæ•°çš„æ¯”ç‰¹ä½ï¼Œå³ 0 å˜æˆ 1ï¼Œ1 å˜æˆ 0</td></tr> <tr><td>å·¦ç§»</td> <td>a &lt;&lt; b</td> <td>å°† a çš„äºŒè¿›åˆ¶å½¢å¼å·¦ç§» b (&lt; 32) ä½ï¼Œå³è¾¹ç”¨ 0 å¡«å……</td></tr> <tr><td>æœ‰ç¬¦å·å³ç§»</td> <td>a &gt;&gt; b</td> <td>å°† a çš„äºŒè¿›åˆ¶å½¢å¼å³ç§» b ä½</td></tr> <tr><td>æ— ç¬¦å·å³ç§»</td> <td>a &gt;&gt;&gt; b</td> <td>å°† a çš„äºŒè¿›åˆ¶å½¢å¼å³ç§» b ä½ï¼Œå¹¶ä½¿ç”¨ 0 åœ¨å·¦ä¾§å¡«å……</td></tr> <tr><td>è¡¥ç </td> <td>---</td> <td>å¦‚ a çš„è´Ÿå¯¹åº”å€¼ï¼Œâ€˜ æŒ‰ä½é â€™ åè½¬å +1</td></tr></tbody></table> <p>æ¥çœ‹çœ‹ç²Ÿå­ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// æœ‰ç¬¦å·å³ç§»,ä¼šè‡ªåŠ¨åˆ¤æ–­,è‹¥0å¼€å¤´åˆ™è¡¥0</span>
<span class="token number">9</span> <span class="token punctuation">(</span>base <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">:</span>       <span class="token number">00000000000000000000000000001001</span> <span class="token punctuation">(</span>base <span class="token number">2</span><span class="token punctuation">)</span>
                   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token number">9</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span> <span class="token punctuation">(</span>base <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">:</span>  <span class="token number">00000000000000000000000000000010</span> <span class="token punctuation">(</span>base <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">(</span>base <span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment">// è‹¥1å¼€å¤´åˆ™è¡¥1</span>

<span class="token operator">-</span><span class="token number">9</span> <span class="token punctuation">(</span>base <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">:</span>      <span class="token number">11111111111111111111111111110111</span> <span class="token punctuation">(</span>base <span class="token number">2</span><span class="token punctuation">)</span>
                   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">-</span><span class="token number">9</span> <span class="token operator">&gt;&gt;</span> <span class="token number">2</span> <span class="token punctuation">(</span>base <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token number">11111111111111111111111111111101</span> <span class="token punctuation">(</span>base <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span> <span class="token punctuation">(</span>base <span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment">// æ— ç¬¦å·å³ç§»</span>

<span class="token operator">-</span><span class="token number">9</span> <span class="token punctuation">(</span>base <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">:</span>       <span class="token number">11111111111111111111111111110111</span> <span class="token punctuation">(</span>base <span class="token number">2</span><span class="token punctuation">)</span>
                    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">-</span><span class="token number">9</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span> <span class="token punctuation">(</span>base <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token number">00111111111111111111111111111101</span> <span class="token punctuation">(</span>base <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1073741821</span> <span class="token punctuation">(</span>base <span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="ä¸»é£Ÿ"><a href="#ä¸»é£Ÿ" class="header-anchor">#</a> ä¸»é£Ÿ</h2> <h3 id="browsersocketfactory-ts"><a href="#browsersocketfactory-ts" class="header-anchor">#</a> browserSocketFactory.ts</h3> <p>æµè§ˆå™¨ç¯å¢ƒä¸‹çš„ websocket æ„é€ å‡½æ•°ï¼ŒåŒ…å«å‘é€å’Œæ¥æ”¶æ•°æ®çš„ç›¸å…³æ–¹æ³•åŠæ•°æ®å¤„ç†é€»è¾‘ç­‰</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">class</span> <span class="token class-name">BrowserWebSocket</span> <span class="token keyword">extends</span> <span class="token class-name">Disposable</span> <span class="token keyword">implements</span> <span class="token class-name">IWebSocket</span> <span class="token punctuation">{</span>
	<span class="token comment">// è¿™é‡Œnewä¸€ä¸ªäº‹ä»¶è§¦å‘å™¨ï¼ŒåŒ…å«fireæ–¹æ³•</span>
	<span class="token comment">// The Emitter can be used to expose an Event to the public to fire it from the insides.</span>
	<span class="token comment">// å¼•ç”¨è‡ª event.ts çš„ Emitter ç±»</span>
	<span class="token comment">// è¿™é‡Œä¸»è¦æ˜¯æ³¨å†Œäº‹ä»¶ï¼Œå¹¶å­˜åœ¨ this._store ä¸­ this_store æ˜¯ DisposableStore å¯¹è±¡æ•°æ®</span>
	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _onData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Emitter<span class="token operator">&lt;</span>ArrayBuffer<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">readonly</span> onData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_onData<span class="token punctuation">.</span>event

	<span class="token keyword">public</span> <span class="token keyword">readonly</span> onOpen<span class="token operator">:</span> Event<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>

	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _onClose <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Emitter<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">readonly</span> onClose <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_onClose<span class="token punctuation">.</span>event

	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _onError <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Emitter<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token keyword">readonly</span> onError <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_onError<span class="token punctuation">.</span>event
	<span class="token comment">// ä»¥ä¸Šçš„æ–¹æ³•æ„Ÿè§‰æ²¡æ€ä¹ˆç”¨åˆ°,è¿™é‡Œå†™è¿™äº›æ–¹æ³•æ˜¯å› ä¸º implements IWebSocket,å› æ­¤åœ¨è¿™é‡Œè¦å…¨éƒ¨å®ç°ä¸€é</span>

	<span class="token comment">// ä¸»è¦æ˜¯è¿™ä¸ª _socket å¯¹è±¡, WebSocket ç±»å‹</span>
	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _socket<span class="token operator">:</span> WebSocket
	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _fileReader<span class="token operator">:</span> FileReader
	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _queue<span class="token operator">:</span> Blob<span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token keyword">private</span> _isReading<span class="token operator">:</span> <span class="token builtin">boolean</span>
	<span class="token keyword">private</span> _isClosed<span class="token operator">:</span> <span class="token builtin">boolean</span>

	<span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token function-variable function">_socketMessageListener</span><span class="token operator">:</span> <span class="token punctuation">(</span>ev<span class="token operator">:</span> MessageEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>

	<span class="token keyword">constructor</span><span class="token punctuation">(</span>socket<span class="token operator">:</span> WebSocket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// åŒ…å«äº†ä¸€ä¸ªæ„é€ å‡½æ•°,å› æ­¤å¿…é¡»è°ƒç”¨ super æ–¹æ³•,ä¸”éœ€è¦åœ¨ä½¿ç”¨ this ä¹‹å‰è°ƒç”¨</span>
		<span class="token comment">// åœ¨ es5 çš„ç»§æ‰¿ä¸­,ä¸€èˆ¬æ˜¯è°ƒç”¨ call æ¥æ”¹å˜ this æŒ‡å‘é—®é¢˜</span>
		<span class="token comment">// ES5ç»§æ‰¿æ˜¯å…ˆåˆ›å»ºå­ç±»çš„å®ä¾‹å¯¹è±¡thisï¼Œç„¶åå†å°†çˆ¶ç±»çš„æ–¹æ³•æ·»åŠ åˆ°thisä¸Šï¼ˆapplyï¼‰</span>
		<span class="token comment">// classç»§æ‰¿æ˜¯å…ˆå°†çˆ¶ç±»çš„å®ä¾‹å’Œæ–¹æ³•æ·»åŠ åˆ°thisä¸Šï¼Œç„¶åå†ç”¨å­ç±»çš„æ„é€ æ–¹æ³•ä¿®æ”¹thisï¼ˆsuperï¼‰</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket <span class="token operator">=</span> socket
		<span class="token keyword">this</span><span class="token punctuation">.</span>_fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_isReading <span class="token operator">=</span> <span class="token boolean">false</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_isClosed <span class="token operator">=</span> <span class="token boolean">false</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span>_fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_isReading <span class="token operator">=</span> <span class="token boolean">false</span>
			<span class="token keyword">const</span> buff <span class="token operator">=</span> <span class="token operator">&lt;</span>ArrayBuffer<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span>result
			<span class="token keyword">this</span><span class="token punctuation">.</span>_onData<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span>
			<span class="token comment">// å½“ queue è¿˜æœ‰æ•°æ®çš„æ—¶å€™ï¼Œç»§ç»­æ‰§è¡Œ</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_queue<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">const</span> <span class="token function-variable function">enqueue</span> <span class="token operator">=</span> <span class="token punctuation">(</span>blob<span class="token operator">:</span> Blob<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token comment">// è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªç¼“å†²é˜Ÿåˆ—,åœ¨æ¥æ”¶åˆ°websocketæ•°æ®çš„æ—¶å€™,ä¼šå…ˆè¿›å…¥é˜Ÿåˆ—</span>
			<span class="token comment">// ç„¶åæ¯å®Œæˆä¸€æ®µæ•°æ®çš„å¤„ç†ä¾¿shift()ä¸€æ®µæ–°çš„æ•°æ®è¿›è¡Œå¤„ç†</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_isReading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_isReading <span class="token operator">=</span> <span class="token boolean">true</span>
			<span class="token comment">// è¿™é‡Œå°†æ”¶åˆ°çš„ Blob æ•°æ®è½¬æ¢æˆ ArrayBuffer</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>_fileReader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">_socketMessageListener</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ev<span class="token operator">:</span> MessageEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token comment">// è¿™é‡Œæ¥æ”¶åˆ°çš„æ•°æ®æ ¼å¼æ˜¯:MessageEvent</span>
			<span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Blob<span class="token operator">&gt;</span>ev<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// websocket çš„ message äº‹ä»¶ï¼Œæ¥æ”¶æœåŠ¡ç«¯ä¼ å›æ¥çš„æ•°æ®</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_socketMessageListener<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">send</span><span class="token punctuation">(</span>data<span class="token operator">:</span> ArrayBuffer <span class="token operator">|</span> ArrayBufferView<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_isClosed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Refuse to write data to closed WebSocket...</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_isClosed <span class="token operator">=</span> <span class="token boolean">true</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_socket<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_socketMessageListener<span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// IWebSocket æ¥å£</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">IWebSocket</span> <span class="token punctuation">{</span>
	<span class="token keyword">readonly</span> onData<span class="token operator">:</span> Event<span class="token operator">&lt;</span>ArrayBuffer<span class="token operator">&gt;</span>
	<span class="token keyword">readonly</span> onOpen<span class="token operator">:</span> Event<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
	<span class="token keyword">readonly</span> onClose<span class="token operator">:</span> Event<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span>
	<span class="token keyword">readonly</span> onError<span class="token operator">:</span> Event<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span>

	<span class="token function">send</span><span class="token punctuation">(</span>data<span class="token operator">:</span> ArrayBuffer <span class="token operator">|</span> ArrayBufferView<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
	<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ipc-net-ts"><a href="#ipc-net-ts" class="header-anchor">#</a> ipc.net.ts</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">WebSocketNodeSocket</span> <span class="token keyword">extends</span> <span class="token class-name">Disposable</span> <span class="token keyword">implements</span> <span class="token class-name">ISocket</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">readonly</span> socket<span class="token operator">:</span> NodeSocket
	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _incomingData<span class="token operator">:</span> ChunkStream
	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _onData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Emitter<span class="token operator">&lt;</span>VSBuffer<span class="token operator">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">private</span> <span class="token keyword">readonly</span> _state <span class="token operator">=</span> <span class="token punctuation">{</span>
		state<span class="token operator">:</span> ReadState<span class="token punctuation">.</span>PeekHeader<span class="token punctuation">,</span>
		readLen<span class="token operator">:</span> Constants<span class="token punctuation">.</span>MinHeaderByteSize<span class="token punctuation">,</span>
		mask<span class="token operator">:</span> <span class="token number">0</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">constructor</span><span class="token punctuation">(</span>socket<span class="token operator">:</span> NodeSocket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>socket <span class="token operator">=</span> socket
		<span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChunkStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_register</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">onData</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_acceptChunk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">onData</span><span class="token punctuation">(</span><span class="token function-variable function">listener</span><span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> VSBuffer<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> IDisposable <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_onData<span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">onClose</span><span class="token punctuation">(</span><span class="token function-variable function">listener</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> IDisposable <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">onClose</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">onEnd</span><span class="token punctuation">(</span><span class="token function-variable function">listener</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">:</span> IDisposable <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">onEnd</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token operator">:</span> VSBuffer<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
		<span class="token comment">// åˆå§‹åŒ– headerLen ä¸ºæœ€å°å¤´éƒ¨é•¿åº¦</span>
		<span class="token keyword">let</span> headerLen <span class="token operator">=</span> Constants<span class="token punctuation">.</span>MinHeaderByteSize
		<span class="token comment">// æ ¹æ®å­—èŠ‚é•¿åº¦ï¼Œç¡®å®š headerLen çš„å¤§å°</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&lt;</span> <span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			headerLen <span class="token operator">+=</span> <span class="token number">0</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			headerLen <span class="token operator">+=</span> <span class="token number">2</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			headerLen <span class="token operator">+=</span> <span class="token number">8</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// åˆ›å»º headerLen é•¿åº¦çš„å­—èŠ‚åºåˆ—</span>
		<span class="token keyword">const</span> header <span class="token operator">=</span> VSBuffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span>headerLen<span class="token punctuation">)</span>
		<span class="token comment">// ç¬¬ä¸€ä½æ— ç¬¦å·æ•´æ•°ä¿®æ”¹ä¸º 0b10000010  == 130</span>
		header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0b10000010</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&lt;</span> <span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// ç¡®å®šç¬¬äºŒå­—èŠ‚çš„å€¼</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">1</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">1</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
			<span class="token comment">// buffer.byteLength æ¢æˆäºŒè¿›åˆ¶ï¼Œæ— ç¬¦å·å³ç§»åæ‰§è¡Œä¸æ“ä½œ</span>
			<span class="token comment">// ç›®çš„æ˜¯å–å¦‚è¶…è¿‡ 2**24 ä¹‹åçš„æ•°æ®</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
			header<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span><span class="token punctuation">,</span> <span class="token operator">++</span>offset<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// è¿™é‡Œè¿”å›çš„æ•°æ®æ—¶ VSBufferï¼Œä½†å®é™…ä¸Šå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„æ˜¯ MessageEvent æ ¼å¼æ•°æ®ï¼ŒåŒ…å«å…¶ä»–å¦‚ï¼šwsæ¥æºä¿¡æ¯ç­‰</span>
		<span class="token comment">// æ•°æ®éƒ½å­˜åœ¨ e.data å†…ï¼Œå¹¶ä¸” MessageEvent çš„æ ¼å¼ä¸º Blob æ•°æ®</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>VSBuffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>header<span class="token punctuation">,</span> buffer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token function">_acceptChunk</span><span class="token punctuation">(</span>data<span class="token operator">:</span> VSBuffer<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>byteLength <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span><span class="token function">acceptChunk</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
		<span class="token comment">// å®šä¹‰çš„ chunkNum ç±»å‹æ•°æ®ï¼Œä»¥ VSBuffer[] å½¢å¼å­˜å‚¨æ‰€æœ‰æ¥æ”¶åˆ°çš„æ•°æ®</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// åªè¦ _incomingData çš„å­—èŠ‚é•¿åº¦å¤§äºæœ€å°å¤´éƒ¨é•¿åº¦ï¼ˆå³2ï¼‰æ—¶ï¼Œéå†è¯»æ•°æ®</span>
			<span class="token comment">// ä¸‹é¢çš„åˆ¤æ–­æ¡ä»¶æ˜¯ä¸ºäº†é™åˆ¶è¯»å–é¡ºåºï¼šç¡®è®¤å¤´éƒ¨ä¿¡æ¯-&gt; æå–å¤´éƒ¨ä¿¡æ¯ -&gt; æå–dataæ•°æ®</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">===</span> ReadState<span class="token punctuation">.</span>PeekHeader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// chunkNum ç±»å‹æ–¹æ³•ï¼Œpeek æ˜¯è¯»å–æ•°æ®çš„æ–¹æ³•ï¼Œå¼€å§‹è¯»å–æœ€å°å¤´éƒ¨é•¿åº¦çš„æ•°æ®ï¼ˆè¯»2ä½æ•°æ®ï¼‰</span>
				<span class="token keyword">const</span> peekHeader <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen<span class="token punctuation">)</span>
				<span class="token comment">// secondByte ä¸ºç¬¬äºŒå­—èŠ‚æ•°æ®ï¼ŒreadUInt8 æ˜¯æŒ‡è¯»å–ç¬¬ offset ä½çš„æ— ç¬¦å·çš„8ä½æ•´æ•°å€¼</span>
				<span class="token comment">// å¯ä»¥å‚è€ƒnodejs apiä¸­æ–‡æ–‡æ¡£ï¼šhttp://nodejs.cn/api/buffer.html</span>
				<span class="token keyword">const</span> secondByte <span class="token operator">=</span> peekHeader<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token comment">// å°†ç¬¬äºŒå­—èŠ‚æ•°æ®ï¼ˆæœ€å¤§ä¸º255ï¼‰ä¸ 0b10000000 åš â€˜ä¸â€™ çš„æ“ä½œï¼Œç„¶åå³ç§»ä¸ƒä½å¾—åˆ°ä¸€ä¸ª â€˜æ ‡å¿—æ•°å­—â€™</span>
				<span class="token comment">// è¿™ä¸ªæ ‡å¿—æ•°å­—ä¸ºmaskï¼Œä¹Ÿå°±æ˜¯ websocket ä¸­çš„æ©ç ï¼Œä¸»è¦é’ˆå¯¹å®‰å…¨æ–¹é¢çš„ä¼˜åŒ–ï¼Œé¿å…è¢«ä¸­é—´è®¾å¤‡æ”»å‡»</span>
				<span class="token comment">// è¿™ä¸€é¡¹ä»…å¯ä»¥åœ¨å®¢æˆ·ç«¯è®¾ç½®ï¼Œå¦‚æœåœ¨æœåŠ¡ç«¯è®¾ç½®äº†ä¼šæŠ¥é”™ï¼šåªæœ‰å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æ‰éœ€è¦æ©ç å¤„ç†</span>
				<span class="token keyword">const</span> hasMask <span class="token operator">=</span> <span class="token punctuation">(</span>secondByte <span class="token operator">&amp;</span> <span class="token number">0b10000000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">7</span>
				<span class="token keyword">const</span> len <span class="token operator">=</span> secondByte <span class="token operator">&amp;</span> <span class="token number">0b01111111</span>
				<span class="token comment">// æ‰‹åŠ¨è°ƒæ•´ _state çš„æ•°æ®ï¼Œä½¿è¿›å…¥ä¸‹ä¸€ä¸ªé€»è¾‘åˆ¤æ–­</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">=</span> ReadState<span class="token punctuation">.</span>ReadHeader
				<span class="token comment">// è®¡ç®—ä¸‹ä¸€æ­¥è¯»å–æ•°æ®çš„é•¿åº¦</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen <span class="token operator">=</span> Constants<span class="token punctuation">.</span>MinHeaderByteSize <span class="token operator">+</span> <span class="token punctuation">(</span>hasMask <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">126</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">127</span> <span class="token operator">?</span> <span class="token number">8</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>mask <span class="token operator">=</span> <span class="token number">0</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">===</span> ReadState<span class="token punctuation">.</span>ReadHeader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// read entire header</span>
				<span class="token comment">// read æ–¹æ³•ä¼šä¿®æ”¹æºæ•°æ®ï¼šå–å‡º chunksï¼ˆVSBuffer[]ï¼‰ ä¸­çš„ç¬¬ä¸€é¡¹æ•°æ® - shift()</span>
				<span class="token keyword">const</span> header <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen<span class="token punctuation">)</span>
				<span class="token keyword">const</span> secondByte <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token keyword">const</span> hasMask <span class="token operator">=</span> <span class="token punctuation">(</span>secondByte <span class="token operator">&amp;</span> <span class="token number">0b10000000</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">7</span>
				<span class="token keyword">let</span> len <span class="token operator">=</span> secondByte <span class="token operator">&amp;</span> <span class="token number">0b01111111</span>

				<span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">1</span>
				<span class="token comment">// 2 ** 8 æ˜¯è®¡ç®—2çš„næ¬¡æ–¹</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// è¯»å–headerç¬¬äºŒå­—èŠ‚çš„æ•°å­—,ç„¶åå† * 2 ** 8 + ç¬¬ä¸‰å­—èŠ‚çš„æ•°å­—ï¼Œè®¡ç®—å‡ºé•¿åº¦len</span>
					len <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">8</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">127</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// åŒä¸Š</span>
					len <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">24</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">16</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">8</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">let</span> mask <span class="token operator">=</span> <span class="token number">0</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>hasMask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// è®¡ç®—å®Œlenä¹‹åï¼Œoffseté€’å¢ï¼Œå†è®¡ç®—mask</span>
					mask <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">24</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">16</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">8</span> <span class="token operator">+</span> header<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span><span class="token operator">++</span>offset<span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// è¿™é‡ŒåŒæ ·è®¾ç½®ä¸€ä¸ªå®šå€¼ï¼Œç”¨äºä¸‹ä¸€æ­¥çš„é€»è¾‘åˆ¤æ–­ï¼Œä½¿ä¹‹è¿›å…¥ä¸‹ä¸€é˜¶æ®µå¤„ç†</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">=</span> ReadState<span class="token punctuation">.</span>ReadBody
				<span class="token comment">// å­˜å‚¨ä¸‹ä¸€æ­¥è¯»å–æ•°æ®çš„é•¿åº¦</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen <span class="token operator">=</span> len
				<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>mask <span class="token operator">=</span> mask
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">===</span> ReadState<span class="token punctuation">.</span>ReadBody<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// åŒæ ·æ˜¯ shift() æ•°ç»„ä¸­çš„ç¬¬ä¸€é¡¹å­˜å‚¨åœ¨ body</span>
				<span class="token comment">// åˆ°è¿™é‡Œçš„ VSBuffer è¿˜ä¸æ˜¯æœ€ç»ˆçš„å¯ä»¥è½¬æ¢çš„æ•°æ®</span>
				<span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_incomingData<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen<span class="token punctuation">)</span>
				<span class="token comment">// è¿™é‡Œæ‰§è¡Œ unmaskæ–¹æ³•ï¼Œæœ€ç»ˆçš„æ•°æ®åœ¨è¿™ä¸ªæ–¹æ³•ä½“å¯ä»¥æ‹¿åˆ°</span>
				<span class="token function">unmask</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>mask<span class="token punctuation">)</span>
				<span class="token comment">// æ¢å¤ _state ä¸ºå¼€å§‹çš„æ•°æ®ï¼Œé‡æ–°å¼€å§‹æ–°ä¸€è½®æ•°æ®çš„å¤„ç†</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>state <span class="token operator">=</span> ReadState<span class="token punctuation">.</span>PeekHeader
				<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>readLen <span class="token operator">=</span> Constants<span class="token punctuation">.</span>MinHeaderByteSize
				<span class="token keyword">this</span><span class="token punctuation">.</span>_state<span class="token punctuation">.</span>mask <span class="token operator">=</span> <span class="token number">0</span>
				<span class="token comment">// TODO: fireçš„ä½œç”¨ï¼Ÿç±»ä¼¼è§¦å‘æ‰€æœ‰å…³è”äº‹ä»¶ï¼Ÿ</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_onData<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">unmask</span><span class="token punctuation">(</span>buffer<span class="token operator">:</span> VSBuffer<span class="token punctuation">,</span> mask<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mask <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">let</span> cnt <span class="token operator">=</span> buffer<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">2</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cnt<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> v <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">readUInt32BE</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span>
		buffer<span class="token punctuation">.</span><span class="token function">writeUInt32BE</span><span class="token punctuation">(</span>v <span class="token operator">^</span> mask<span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">let</span> offset <span class="token operator">=</span> cnt <span class="token operator">*</span> <span class="token number">4</span>
	<span class="token keyword">let</span> bytesLeft <span class="token operator">=</span> buffer<span class="token punctuation">.</span>byteLength <span class="token operator">-</span> offset
	<span class="token keyword">const</span> m3 <span class="token operator">=</span> <span class="token punctuation">(</span>mask <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span>
	<span class="token keyword">const</span> m2 <span class="token operator">=</span> <span class="token punctuation">(</span>mask <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span>
	<span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token punctuation">(</span>mask <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0b11111111</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bytesLeft <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		buffer<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span> <span class="token operator">^</span> m3<span class="token punctuation">,</span> offset<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bytesLeft <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		buffer<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">^</span> m2<span class="token punctuation">,</span> offset <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bytesLeft <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		buffer<span class="token punctuation">.</span><span class="token function">writeUInt8</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">readUInt8</span><span class="token punctuation">(</span>offset <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">^</span> m1<span class="token punctuation">,</span> offset <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="chunkstream-class"><a href="#chunkstream-class" class="header-anchor">#</a> ChunkStream class</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ChunkStream</span> <span class="token punctuation">{</span>
	<span class="token comment">// ç›¸å½“äº Buffer æ•°ç»„</span>
	<span class="token keyword">private</span> _chunks<span class="token operator">:</span> VSBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token comment">// å­—èŠ‚é•¿åº¦</span>
	<span class="token keyword">private</span> _totalLength<span class="token operator">:</span> <span class="token builtin">number</span>

	<span class="token keyword">public</span> <span class="token keyword">get</span> <span class="token function">byteLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// è·å–å­—èŠ‚é•¿åº¦</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength
	<span class="token punctuation">}</span>

	<span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">acceptChunk</span><span class="token punctuation">(</span>buff<span class="token operator">:</span> VSBuffer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ç¼“å†²æ¥æ”¶åˆ°çš„ bufferï¼Œå­˜åœ¨æ•°ç»„é‡Œ _chunks</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">+=</span> buff<span class="token punctuation">.</span>byteLength
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">read</span><span class="token punctuation">(</span>byteCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> VSBuffer <span class="token punctuation">{</span>
		<span class="token comment">// è¯»å–å¹¶æˆªå–ç¬¬ä¸€é¡¹æ•°æ®ï¼Œä¼šæ”¹å˜æº Buffer</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_read</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token function">peek</span><span class="token punctuation">(</span>byteCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> VSBuffer <span class="token punctuation">{</span>
		<span class="token comment">// ä»…è¯»å–ç¬¬ä¸€é¡¹æ•°æ®ï¼Œä¸æ”¹å˜æº Buffer</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_read</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token function">_read</span><span class="token punctuation">(</span>byteCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> advance<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> VSBuffer <span class="token punctuation">{</span>
		<span class="token comment">// å®é™…æ‰§è¡Œè¯»å–æ“ä½œçš„å‡½æ•°ï¼Œæ ¹æ®å­—èŠ‚é•¿åº¦åŒºåˆ†ä¸åŒå¤„ç†æ–¹æ³•</span>
		<span class="token comment">// å…ˆå¤„ç†è¾¹ç•Œæƒ…å†µ</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>byteCount <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">getEmptyBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>byteCount <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// å°†è¯»å–çš„é•¿åº¦è¶…è¿‡æ€»é•¿ï¼Œä¼šæŠ¥é”™</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot read so many bytes!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>byteLength <span class="token operator">===</span> byteCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// super fast path, precisely first chunk must be returned</span>
			<span class="token comment">// å–ç¬¬ä¸€é¡¹æ•°æ®</span>
			<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>advance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// shift æ‰ç¬¬ä¸€é¡¹æ•°æ®</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token comment">// åŒæ—¶ä¿®æ”¹æ€»é•¿</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">-=</span> byteCount
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> result
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>byteLength <span class="token operator">&gt;</span> byteCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// fast path, the reading is entirely within the first chunk</span>
			<span class="token comment">// å¦‚æœç¬¬ä¸€é¡¹æ•°æ®é•¿åº¦è¶…è¿‡è¦è¯»å–çš„å­—èŠ‚é•¿åº¦ï¼Œé‚£ä¹ˆåªéœ€è¦è¯» byteCount é•¿åº¦çš„æ•°æ®</span>
			<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> byteCount<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>advance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">)</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">-=</span> byteCount
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> result
		<span class="token punctuation">}</span>

		<span class="token comment">// VSBuffer.alloc: åˆ›å»º byteCount é•¿çš„ Buffer æ•°æ®ï¼Œå¹¶åˆå§‹åŒ–æ¯ä¸€é¡¹ä¸º0</span>
		<span class="token comment">// TODO: ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæ‰§è¡Œä¸‹é¢ä»£ç ï¼Ÿ</span>
		<span class="token keyword">let</span> result <span class="token operator">=</span> VSBuffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">)</span>
		<span class="token keyword">let</span> resultOffset <span class="token operator">=</span> <span class="token number">0</span>
		<span class="token keyword">let</span> chunkIndex <span class="token operator">=</span> <span class="token number">0</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>byteCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// ä¾æ—§æ˜¯å–ç¬¬ä¸€é¡¹æ•°æ®</span>
			<span class="token keyword">const</span> chunk <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span>chunkIndex<span class="token punctuation">]</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">.</span>byteLength <span class="token operator">&gt;</span> byteCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// this chunk will survive</span>
				<span class="token keyword">const</span> chunkPart <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> byteCount<span class="token punctuation">)</span>
				<span class="token comment">// resultè¿™é‡Œè°ƒç”¨setæ–¹æ³•ï¼Œå®é™…æ˜¯è°ƒç”¨ Uint8Array çš„ set æ–¹æ³•ã€‚åœ¨ VSBuffer å†…è¿˜æ˜¯ç”¨çš„ Uint8Array ç±»å‹æ•°æ®</span>
				<span class="token comment">// å‚è€ƒï¼šhttps://github.com/microsoft/vscode/tree/master/src/vs/base/common/buffer.ts ä¸­çš„ Buffer ç±»</span>
				result<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>chunkPart<span class="token punctuation">,</span> resultOffset<span class="token punctuation">)</span>
				resultOffset <span class="token operator">+=</span> byteCount

				<span class="token keyword">if</span> <span class="token punctuation">(</span>advance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// è¿™é‡Œè¿›è¡Œä¸€æ¬¡è£å‰ªï¼Œè¶…è¿‡byteCounté•¿åº¦çš„éƒ½è¢«è£æ‰</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">[</span>chunkIndex<span class="token punctuation">]</span> <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>byteCount<span class="token punctuation">)</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">-=</span> byteCount
				<span class="token punctuation">}</span>

				byteCount <span class="token operator">-=</span> byteCount
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// è¿™é‡Œçš„å¤„ç† åŒä¸Š</span>
				<span class="token comment">// this chunk will be entirely read</span>
				result<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> resultOffset<span class="token punctuation">)</span>
				resultOffset <span class="token operator">+=</span> chunk<span class="token punctuation">.</span>byteLength

				<span class="token keyword">if</span> <span class="token punctuation">(</span>advance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>_chunks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>_totalLength <span class="token operator">-=</span> chunk<span class="token punctuation">.</span>byteLength
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					chunkIndex<span class="token operator">++</span>
				<span class="token punctuation">}</span>

				byteCount <span class="token operator">-=</span> chunk<span class="token punctuation">.</span>byteLength
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// æ³¨æ„è¿™é‡Œè¿”å›çš„å°±æ˜¯ VSBuffer æ ¼å¼æ•°æ®ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ toString æ–¹æ³• decode</span>
		<span class="token keyword">return</span> result
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="é¥­åç”œç‚¹"><a href="#é¥­åç”œç‚¹" class="header-anchor">#</a> é¥­åç”œç‚¹</h2> <h3 id="è›‹ç³•"><a href="#è›‹ç³•" class="header-anchor">#</a> è›‹ç³•</h3> <ul><li>ä¿®æ”¹çš„æºç è¦ç¡®ä¿ä¸èƒ½å‡ºç°é”™è¯¯å¦‚ï¼š tslint æç¤ºè¯­æ³•é”™è¯¯çš„ä»£ç ç­‰</li> <li>æ‰“åŒ…çš„ patch æ–‡ä»¶ä¸€å®šè¦æ³¨æ„ï¼Œç¼–ç æ˜¯ <strong><code>UTF-8</code></strong>ï¼Œä¸”æ¢è¡Œç¬¦çš„æ ¼å¼æ˜¯ï¼š<strong><code>LF</code></strong>ï¼ˆé»˜è®¤æ˜¯<code>CRLF</code>ï¼‰</li> <li>å¦‚æœé‡åˆ° patch å¤±è´¥é—®é¢˜ï¼Œå¯ä»¥å…ˆè¯•è¯•æ¸…é™¤æœåŠ¡å™¨çš„ç¼“å­˜ï¼ˆé‡æ–° clone é¡¹ç›®ä»£ç ï¼‰ï¼Œç„¶åå†é‡æ–°æ‰§è¡Œ <code>yarn build</code></li> <li>æ³¨æ„ vscode å†…éƒ¨åŒæ—¶æœ‰æµè§ˆå™¨ç¯å¢ƒå’Œ node ç¯å¢ƒï¼Œè¦æ³¨æ„ä½¿ç”¨å±æ€§çš„å…¼å®¹æ€§ï¼Œé¿å…æŠ¥é”™</li> <li>è¿è¡Œè¿‡ç¨‹ä¸­æœ‰æ—¶ä¼šä¸€ç›´é‡è¿ï¼Œç„¶åçªç„¶å´©æºƒå°±ä¸€ç›´è¿ä¸ä¸Šï¼Œå…·ä½“ä»€ä¹ˆåŸå› ä¸æ¸…æ¥š</li> <li><code>trailing whitespace</code> æŠ¥é”™æ˜¯æŒ‡ï¼Œä»£ç æœ€åä¸€ä¸ªå­—ç¬¦å¿…é¡»ä»¥ ';' ç»“å°¾ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼ˆå¯ä»¥è¯•è¯• <code>--whitespace=fix</code>ï¼‰</li></ul> <h3 id="æ°´æœ"><a href="#æ°´æœ" class="header-anchor">#</a> æ°´æœ</h3> <ul><li><code>code-server</code> åŸºæœ¬ä¾èµ–éƒ½æ˜¯åœ¨ <code>vscode</code> ä¸Šï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°çš„ <code>source</code> æ¿å—æ˜¯æœä¸åˆ°ä»»ä½• <code>code-server</code> ç›®å½•ä¸‹çš„ç›¸å…³ä»£ç ï¼Œåªæœ‰å­˜åœ¨äº <code>vscode</code> çš„æ‰èƒ½æœåˆ°</li> <li><code>ipc</code> æ˜¯è¿›ç¨‹ä¹‹é—´çš„äº¤äº’æ–¹å¼ï¼Œ</li> <li>ä¸¤ä¸ª <code>websocket</code> ä¸­ç¬¬ä¸€ä¸ªä¸»è¦æ˜¯æ•°æ®äº¤äº’ï¼Œç¬¬äºŒä¸ªä¸»è¦æ˜¯ç”¨äºå¿ƒè·³æ£€æµ‹</li></ul> <h2 id="ç¦»å¸­"><a href="#ç¦»å¸­" class="header-anchor">#</a> ç¦»å¸­</h2> <p>å‚è€ƒåœ°å€</p> <ul><li><a href="https://juejin.cn/post/6844904024005672968" target="_blank" rel="noopener noreferrer">code-server æ˜¯å¦‚ä½•æŠŠ vscode æ¬åˆ°æµè§ˆå™¨çš„<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://zh.javascript.info/arraybuffer-binary-arrays" target="_blank" rel="noopener noreferrer">ArrayBufferï¼ŒäºŒè¿›åˆ¶æ•°ç»„<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://github.com/microsoft/vscode" target="_blank" rel="noopener noreferrer">vscode æºç <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://github.com/cdr/code-server" target="_blank" rel="noopener noreferrer">code-server æºç <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="http://nodejs.cn/api/" target="_blank" rel="noopener noreferrer">nodeJS API æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="noopener noreferrer">ArrayBuffer MDN æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noopener noreferrer">TypedArray MDN æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener noreferrer">Blob MDN æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators" target="_blank" rel="noopener noreferrer">æŒ‰ä½æ“ä½œç¬¦ MDN æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ğŸš€</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Real102/Blog/edit/master/docs/demo/page1.md" target="_blank" rel="noopener noreferrer">Edit in GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/16/2020, 9:07:37 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/Blog/demo/" class="prev router-link-active">
        ä»‹ç»
      </a></span> <span class="next"><a href="/Blog/demo/page2.html">
        æ•°æ®ç±»å‹ä¸è½¬æ¢
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Blog/assets/js/app.48336645.js" defer></script><script src="/Blog/assets/js/2.66b2721a.js" defer></script><script src="/Blog/assets/js/22.487da7c4.js" defer></script>
  </body>
</html>
