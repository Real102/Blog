(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{368:function(t,s,a){t.exports=a.p+"assets/img/wx-ceshihao.785adcf3.png"},369:function(t,s,a){t.exports=a.p+"assets/img/wx-signature.bd8f0faa.png"},370:function(t,s,a){t.exports=a.p+"assets/img/wx-success.86ba0c91.png"},442:function(t,s,a){"use strict";a.r(s);var n=a(45),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"微信-js-sdk-实现自定义分享功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微信-js-sdk-实现自定义分享功能"}},[t._v("#")]),t._v(" 微信 JS-SDK 实现自定义分享功能")]),t._v(" "),n("p",[n("code",[t._v("H5")]),t._v(" 页面中如果需要使用到微信的功能如：微信分享、扫一扫、卡包等微信特有的能力，那么就需要用到微信 "),n("code",[t._v("JS-SDK")])]),t._v(" "),n("p",[t._v("由于业务需求，刚好用到了这一块，就稍微总结分享一下自己在 "),n("code",[t._v("vue3")]),t._v(" 项目中（"),n("em",[t._v("本地测试环境")]),t._v("）使用微信 "),n("code",[t._v("JS-SDK")]),t._v(" 的流程，以及一些需要注意的点")]),t._v(" "),n("h2",{attrs:{id:"前期准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前期准备"}},[t._v("#")]),t._v(" 前期准备")]),t._v(" "),n("ul",[n("li",[t._v("公众号：本地测试环境，暂时用 "),n("a",{attrs:{href:"https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&t=sandbox/index",target:"_blank",rel:"noopener noreferrer"}},[t._v("测试号"),n("OutboundLink")],1),t._v(" 代替；部分功能需要用到实名认证，正式环境最好提前完成公众号的实名认证")]),t._v(" "),n("li",[n("code",[t._v("AppID")]),t._v("、"),n("code",[t._v("AppSecret")])]),t._v(" "),n("li",[t._v("公众号配置 JS 安全域名")]),t._v(" "),n("li",[t._v("微信开发者工具：可以查看授权信息以及调试项目")])]),t._v(" "),n("h2",{attrs:{id:"公众号配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#公众号配置"}},[t._v("#")]),t._v(" 公众号配置")]),t._v(" "),n("p",[t._v("开发环境下可以直接拿官方提供的 "),n("a",{attrs:{href:"https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&t=sandbox/index",target:"_blank",rel:"noopener noreferrer"}},[t._v("测试号"),n("OutboundLink")],1),t._v(" 来测试。具体如下图：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(368),alt:"测试号",title:"测试号"}})]),t._v(" "),n("p",[t._v("然后我们配置一下 "),n("code",[t._v("JS")]),t._v(" 接口安全域名，如果是用的测试号，那么这里的地址也可以直接使用 "),n("code",[t._v("ip")]),t._v("。需要注意，这里的链接不能带 "),n("code",[t._v("http://")]),t._v(" （公众号上添加路径如下： "),n("code",[t._v("公众号 > 设置与开发 > 公众号设置 > 功能设置")]),t._v("）")]),t._v(" "),n("h2",{attrs:{id:"获取-signature"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取-signature"}},[t._v("#")]),t._v(" 获取 signature")]),t._v(" "),n("ul",[n("li",[t._v("第一步先获取 "),n("code",[t._v("access_token")])])]),t._v(" "),n("p",[t._v("直接在浏览器地址栏输入："),n("code",[t._v("https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=APPID&secret=APPSECRET")]),t._v(" 即可获取到 "),n("code",[t._v("access_token")]),t._v("。其中 "),n("code",[t._v("appid")]),t._v(" 和 "),n("code",[t._v("appsecret")]),t._v(" 为目标公众号的信息，目前为测试号信息")]),t._v(" "),n("p",[t._v("注意 "),n("code",[t._v("access_token")]),t._v(" 有效期为 "),n("code",[t._v("7200s")]),t._v("，需要缓存起来，过期后再重新获取，避免达到获取次数上限")]),t._v(" "),n("ul",[n("li",[t._v("第二步获取 "),n("code",[t._v("jsapi_ticket")])])]),t._v(" "),n("p",[t._v("再次在浏览器地址栏输入 "),n("code",[t._v("https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=ACCESS_TOKEN&type=jsapi")]),t._v("，其中 "),n("code",[t._v("ACCESS_TOKEN")]),t._v(" 需要替换为第一步中获取的 "),n("code",[t._v("access_token")])]),t._v(" "),n("ul",[n("li",[t._v("第三步获取 "),n("code",[t._v("signature")])])]),t._v(" "),n("p",[t._v("打开微信提供的签名校验工具："),n("code",[t._v("http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign")]),t._v("，分别输入对应的内容。具体如下图：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(369),alt:"测试号",title:"测试号"}})]),t._v(" "),n("p",[t._v("点击即可生成 signature 签名。这里需要注意 "),n("code",[t._v("timestamp")]),t._v(" 的单位是 "),n("code",[t._v("秒")]),t._v(" （即 "),n("code",[t._v("10")]),t._v(" 位）")]),t._v(" "),n("h2",{attrs:{id:"jsapi-授权"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jsapi-授权"}},[t._v("#")]),t._v(" JSAPI 授权")]),t._v(" "),n("p",[t._v("获取到签名后就比较简单了，直接贴代码，将对应字段给填上即可。"),n("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#63",target:"_blank",rel:"noopener noreferrer"}},[t._v("jsApiList"),n("OutboundLink")],1),t._v(" 为待授权的 JS 接口列表，这里参考填上需要授权的接口，")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("wx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  debug"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开启调试模式,调用的所有 api 的返回值会在客户端 alert 出来，若要查看传入的参数，可以在 pc 端打开，参数信息会通过 log 打出，仅在 pc 端时才会打印。")]),t._v("\n  appId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必填，公众号的唯一标识")]),t._v("\n  timestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必填，生成签名的时间戳")]),t._v("\n  nonceStr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必填，生成签名的随机串")]),t._v("\n  signature"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必填，签名")]),t._v("\n  jsApiList"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updateTimelineShareData"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"updateAppMessageShareData"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必填，需要使用的 JS 接口列表")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("这样就完成了微信授权流程，接下来就是在 "),n("code",[t._v("wx.ready")]),t._v(" 中初始化分享配置")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("wx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ready")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//需在用户可能点击分享按钮前就先调用")]),t._v("\n  wx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateAppMessageShareData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    title"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"凭你的智慧，我唬得了你吗？"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分享标题")]),t._v("\n    desc"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"我们是受过严格训练的，无论多好笑都不会笑，除非忍不住"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分享描述")]),t._v("\n    link"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分享链接，该链接域名或路径必须与当前页面对应的公众号 JS 安全域名一致")]),t._v("\n    imgUrl"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" shareIcon"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分享图标")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("success")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置成功")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  wx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateTimelineShareData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    title"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"凭你的智慧，我唬得了你吗？"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分享标题")]),t._v("\n    link"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分享链接，该链接域名或路径必须与当前页面对应的公众号 JS 安全域名一致")]),t._v("\n    imgUrl"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" shareIcon"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分享图标")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("success")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置成功")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"可能会遇到的情况"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#可能会遇到的情况"}},[t._v("#")]),t._v(" 可能会遇到的情况")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("授权失败")])])]),t._v(" "),n("p",[t._v("按照上面的流程，如果授权失败可复查一下：")]),t._v(" "),n("ol",[n("li",[t._v("是否正确配置 "),n("code",[t._v("JS")]),t._v(" 安全域名")]),t._v(" "),n("li",[n("code",[t._v("timestamp")]),t._v(" 是否正确（"),n("code",[t._v("10")]),t._v(" 位）")]),t._v(" "),n("li",[t._v("生成签名的 "),n("code",[t._v("url")]),t._v(" 是否正确配置")]),t._v(" "),n("li",[n("code",[t._v("jsApiList")]),t._v(" 是否已配置")])]),t._v(" "),n("p",[t._v("授权成功后，控制台可查看到如下结果：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(370),alt:"测试号",title:"测试号"}})]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("分享出来的是链接")])])]),t._v(" "),n("p",[t._v("如果在微信开发者工具显示授权成功，但是在手机上分享出去却是链接的话，不用怀疑，是"),n("a",{attrs:{href:"https://developers.weixin.qq.com/community/develop/doc/0006a2e2418ef0a371893e19d50809?highLine=H5%2520%25E5%2588%2586%25E4%25BA%25AB%25E5%2588%25B0%25E6%259C%258B%25E5%258F%258B%25E5%259C%2588",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信的问题"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("目前仅可以通过："),n("code",[t._v("公众号内打开链接")]),t._v("、"),n("code",[t._v("二维码扫码打开")]),t._v("、"),n("code",[t._v("微信收藏内打开")]),t._v("、"),n("code",[t._v("以及通过以上途径分享出来的链接")]),t._v("（正常的分享入口）才能正常使用分享接口")]),t._v(" "),n("h2",{attrs:{id:"写在最后"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#写在最后"}},[t._v("#")]),t._v(" 写在最后")]),t._v(" "),n("p",[t._v("以上是本次分享的所有内容")]),t._v(" "),n("p",[t._v("如果对以上内容有问题，欢迎指教")]),t._v(" "),n("p",[t._v("我是枸哥，可以叫我杞爷")]),t._v(" "),n("h2",{attrs:{id:"参考文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[t._v("#")]),t._v(" 参考文档")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#62",target:"_blank",rel:"noopener noreferrer"}},[t._v("签名算法"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign",target:"_blank",rel:"noopener noreferrer"}},[t._v("签名校验工具"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);