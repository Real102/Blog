(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{372:function(t,s,a){t.exports=a.p+"assets/img/globalImport.c76028d0.png"},373:function(t,s,a){t.exports=a.p+"assets/img/noneImport.6aaa9857.png"},374:function(t,s,a){t.exports=a.p+"assets/img/particalMinSize.108c2d7f.png"},375:function(t,s,a){t.exports=a.p+"assets/img/particalMinChunks.79ead3a3.png"},376:function(t,s,a){t.exports=a.p+"assets/img/particalInitial.8344dc2a.png"},453:function(t,s,a){"use strict";a.r(s);var n=a(45),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"浅析-splitchunks-与-import-方式之间的关系"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浅析-splitchunks-与-import-方式之间的关系"}},[t._v("#")]),t._v(" 浅析 splitChunks 与 import 方式之间的关系")]),t._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),n("p",[n("code",[t._v("webpack")]),t._v(" 拆包分包是性能优化中的常用手段之一，在 "),n("code",[t._v("webpack4")]),t._v(" 之前是用 "),n("code",[t._v("CommonsChunkPlugin")]),t._v(" 来做这一优化，但在 "),n("code",[t._v("webpack4")]),t._v(" 之后被 "),n("code",[t._v("SplitChunksPlugin")]),t._v(" 取而代之。")]),t._v(" "),n("p",[n("code",[t._v("SplitChunksPlugin")]),t._v(" 开箱即用，在 "),n("code",[t._v("webpack")]),t._v(" 官网有一套默认的配置，但对于其默认的配置并不一定适合我们的业务：")]),t._v(" "),n("ul",[n("li",[t._v("新的 "),n("code",[t._v("chunk")]),t._v(" 可以被共享，或者模块来自于 "),n("code",[t._v("node_modules")]),t._v(" 文件夹")]),t._v(" "),n("li",[t._v("新的 "),n("code",[t._v("chunk")]),t._v(" 体积大于 "),n("code",[t._v("20kb")]),t._v("（在进行 "),n("code",[t._v("min+gz")]),t._v(" 之前的体积）")]),t._v(" "),n("li",[t._v("当按需加载 chunks 时，并行请求的最大数量小于或等于 "),n("code",[t._v("30")])]),t._v(" "),n("li",[t._v("当加载初始化页面时，并发请求的最大数量小于或等于 "),n("code",[t._v("30")])])]),t._v(" "),n("p",[t._v("事实上，配置的好坏还跟开发者本身的使用方式有关系：随意一点的开发者喜欢全局引入，而强迫一点的开发者又偏爱动态 "),n("code",[t._v("import")]),t._v("。相同的一份配置不同的引入方式，也会导致打包结果的不同。")]),t._v(" "),n("p",[t._v("以下内容为实验步骤，主要研究 "),n("code",[t._v("minSize")]),t._v(" 和 "),n("code",[t._v("minChunks")]),t._v(" 与引入方式之间的化（"),n("code",[t._v("ài")]),t._v("）学（"),n("code",[t._v("hèn")]),t._v("）反（"),n("code",[t._v("qíng")]),t._v("）应（"),n("code",[t._v("chóu")]),t._v("）。")]),t._v(" "),n("h2",{attrs:{id:"准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[t._v("#")]),t._v(" 准备")]),t._v(" "),n("h3",{attrs:{id:"环境说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#环境说明"}},[t._v("#")]),t._v(" 环境说明")]),t._v(" "),n("p",[t._v("当前使用的环境、版本如下，测试项目为空 "),n("code",[t._v("vue2")]),t._v(" 项目，且是"),n("strong",[t._v("单入口")]),t._v("项目")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("window x64")])]),t._v(" "),n("li",[n("code",[t._v("node")]),t._v(" 版本："),n("code",[t._v("12.12.0")])]),t._v(" "),n("li",[n("code",[t._v("webpack")]),t._v("："),n("code",[t._v("4.46.0")])]),t._v(" "),n("li",[n("code",[t._v("vue")]),t._v("："),n("code",[t._v("2.6.14")])])]),t._v(" "),n("h3",{attrs:{id:"vue-config-js-配置说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue-config-js-配置说明"}},[t._v("#")]),t._v(" vue.config.js 配置说明")]),t._v(" "),n("p",[n("code",[t._v("vue.config.js")]),t._v(" 文件配置如下，需要提前安装 "),n("code",[t._v("webpack-bundle-analyzer")]),t._v(" 依赖。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue.config.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" BundleAnalyzerPlugin "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webpack-bundle-analyzer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("configureWebpack")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("config")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENV")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"analyze"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 手动配置npm命令")]),t._v("\n      config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用打包分析插件")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BundleAnalyzerPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          analyzerHost"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          analyzerPort"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8182"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("chainWebpack")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("config")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("when")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("config")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拆包，减少首次加载vendor文件的大小，减少首屏事件")]),t._v("\n      config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optimization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("splitChunks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 相关配置选项可看官网：https://v4.webpack.docschina.org/plugins/split-chunks-plugin/")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这里的配置针对所有缓存组")]),t._v("\n        chunks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 针对所有代码块")]),t._v("\n        minSize"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最小提取chunk大小")]),t._v("\n        maxSize"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        minChunks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最小引用次数")]),t._v("\n        maxAsyncRequests"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        maxInitialRequests"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        automaticNameDelimiter"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"~"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        automaticNameMaxLength"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        cacheGroups"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将体积较大的包单独分离出来，减少vendor的体积，加快首屏速度")]),t._v("\n          vendors"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chunk-vendors"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// enforce默认为false下不能直接设置name值，否则打包会失败")]),t._v("\n            test"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("[\\\\/]node_modules[\\\\/]")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            priority"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 表示缓存的优先级；")]),t._v("\n            enforce"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("这里配置了 "),n("code",[t._v("npm")]),t._v(" 命令，方便执行分析")]),t._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package.json")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[t._v('"analyze"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"set ENV=analyze&&vue-cli-service build"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"文件结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文件结构"}},[t._v("#")]),t._v(" 文件结构")]),t._v(" "),n("p",[t._v("文件结构主要如下，用于测试的文件为 "),n("code",[t._v("test.vue")]),t._v("，大小约等于 "),n("code",[t._v("14KB")]),t._v("，这就是上配置项 "),n("code",[t._v("minSize")]),t._v(" 值为 "),n("code",[t._v("10000")]),t._v(" 的原因（内容不重要，“大”就行 😃）")]),t._v(" "),n("div",{staticClass:"language-text extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("|-- .vscode 覆盖vscode的配置\n|-- src\n|   |-- components 全局组件/第三方组件\n|       |-- Helloworld.vue\n|       |-- test.vue 全局/局部引入的组件，size≈14KB\n|   |-- views\n|       |-- Home 页面1\n|       |-- About 页面2\n|       |-- Datt 页面3\n|   |-- app.vue 入口文件\n|-- vue.config.js vue 打包配置文件\n")])])]),n("h3",{attrs:{id:"路由结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#路由结构"}},[t._v("#")]),t._v(" 路由结构")]),t._v(" "),n("p",[t._v("注意一下路由，需要为文件指定 "),n("code",[t._v("chunkName")])]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" routes "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Home"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    component"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Home\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/about"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"About"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("component")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/* webpackChunkName: "about" */')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"../views/About.vue"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/datt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"datt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("component")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/* webpackChunkName: "datt" */')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"../views/datt.vue"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("p",[t._v("若不想手动，，，，，"),n("a",{attrs:{href:"https://github.com/Real102/vuesplitchunk.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/Real102/vuesplitchunk.git"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"开淦吧"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开淦吧"}},[t._v("#")]),t._v(" 开淦吧")]),t._v(" "),n("h3",{attrs:{id:"场景一-全局引入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#场景一-全局引入"}},[t._v("#")]),t._v(" 场景一：全局引入")]),t._v(" "),n("p",[t._v("首先来测试一下全局引入的情况，我猜很多 "),n("code",[t._v("GYM")]),t._v(" 会经常干这种事，毕竟方便快捷哈哈哈。")]),t._v(" "),n("p",[t._v("配置项稍微再同步一下，其他项不动。注意 "),n("code",[t._v("mixSize")]),t._v(" 大小要小于 "),n("code",[t._v("test.vue")]),t._v(" 的体积（且要大于 "),n("code",[t._v("helloworld.vue")]),t._v(" 体积）")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optimization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("splitChunks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  minSize"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  minChunks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("跑一下分析命令："),n("code",[t._v("npm run analyze")]),t._v("，会自动打开 "),n("code",[t._v("http://localhost:8182/")]),t._v(" 页面，如下：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(372),alt:"全局引入",title:"全局引入"}})]),t._v(" "),n("p",[t._v("为了看起来舒服一些，已经把 "),n("code",[t._v("chunk-vendor")]),t._v(" 隐藏了（后面同样隐藏）。接下来保留分析的页面，并且暂时取消全局引入 "),n("code",[t._v("test.vue")]),t._v("，重新运行：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(373),alt:"全局引入",title:"全局引入"}})]),t._v(" "),n("p",[t._v("对比以上两张图，全局引入下的 "),n("code",[t._v("app.js")]),t._v(" 跟未引入下情况下，体积差约等于 "),n("code",[t._v("test.vue")]),t._v(" 的体积（实际体积差为 "),n("code",[t._v("12.79KB")]),t._v("，小于 "),n("code",[t._v("test.vue")]),t._v(" 的体积"),n("sup",{staticStyle:{color:"red"}},[t._v(" *")]),t._v("，具体什么原因可以继续往下看）那么可以推测出，"),n("code",[t._v("test.vue")]),t._v(" 其实是被打包到 "),n("code",[t._v("app.js")]),t._v(" 中了（并未单独生成一个 "),n("code",[t._v("chunk")]),t._v("）。")]),t._v(" "),n("p",[n("code",[t._v("GYM")]),t._v(" 如果有兴趣的话可以测试一下，当不满足 "),n("code",[t._v("minSize")]),t._v(" 、 "),n("code",[t._v("minChunks")]),t._v(" 或都不满足时，"),n("code",[t._v("test.vue")]),t._v(" 打包路径的问题。不出意外应该都是被打包到了 "),n("code",[t._v("app.js")]),t._v("（不满足条件当然不会拆包啦，都会被打包到 "),n("code",[t._v("app.js")]),t._v(" 中去）")]),t._v(" "),n("h3",{attrs:{id:"场景二-非首页的局部引入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#场景二-非首页的局部引入"}},[t._v("#")]),t._v(" 场景二：非首页的局部引入")]),t._v(" "),n("p",[t._v("如题所述，取消 "),n("code",[t._v("test.vue")]),t._v(" 的全局引入，单独在 "),n("code",[t._v("about.vue")]),t._v("、"),n("code",[t._v("datt.vue")]),t._v(" 两个文件中引入")]),t._v(" "),n("p",[t._v("首先改一下配置条件，使 "),n("code",[t._v("test.vue")]),t._v(" 仅满足 "),n("code",[t._v("minSize")]),t._v(" 条件。运行分析命令：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optimization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("splitChunks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  minSize"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  minChunks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前不满足3次引用")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(374),alt:"非首页的局部引入-满足minChunks",title:"非首页的局部引入-满足minChunks"}})]),t._v(" "),n("p",[t._v("先不着急分析，我们再改一下配置条件，使 "),n("code",[t._v("test.vue")]),t._v(" 仅满足 "),n("code",[t._v("minChunks")]),t._v(" 条件。运行分析命令：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optimization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("splitChunks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  minSize"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  minChunks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前不满足3次引用")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(375),alt:"非首页的局部引入-满足minSize",title:"非首页的局部引入-满足minSize"}})]),t._v(" "),n("p",[t._v("现在可以对比一下以上两张图，发现有以下两点问题：")]),t._v(" "),n("ol",[n("li",[t._v("仅满足 "),n("code",[t._v("minSize")]),t._v(" 条件时，"),n("code",[t._v("test.vue")]),t._v(" 被拆包了")]),t._v(" "),n("li",[t._v("仅满足 "),n("code",[t._v("minChunks")]),t._v(" 条件时，"),n("code",[t._v("test.vue")]),t._v(" 被分别打包到 "),n("code",[t._v("about.vue")]),t._v(" 和 "),n("code",[t._v("datt.vue")])]),t._v(" "),n("li",[n("code",[t._v("test.vue")]),t._v(" 的体积为 "),n("code",[t._v("12.8KB")])])]),t._v(" "),n("p",[t._v("首先看一下第二个问题，当不满足拆包条件时，"),n("code",[t._v("webpack")]),t._v(" 会将被引用到的组件合并到源文件所属的 "),n("code",[t._v("chunk")]),t._v(" 中去，这个应该没啥毛病")]),t._v(" "),n("p",[t._v("然后是第三个问题，"),n("code",[t._v("test.vue")]),t._v(" 的体积是 "),n("code",[t._v("12.79KB")]),t._v("，对比场景一中的体积差，其实发现几乎是一样的（"),n("code",[t._v("12.79KB")]),t._v(" 与 "),n("code",[t._v("12.8KB")]),t._v("），至于为什么不是 "),n("code",[t._v("14KB")]),t._v("，猜测应该是经过了 "),n("code",[t._v("webpack/terserPlugin")]),t._v(" 压缩处理导致")]),t._v(" "),n("p",[t._v("最后来看看第一个问题吧，我重新又测试了满足 "),n("code",[t._v("minSize")]),t._v(" 条件下 "),n("code",[t._v("minChunks")]),t._v(" 值为 "),n("code",[t._v("13")]),t._v(" 甚至 "),n("code",[t._v("30")]),t._v(" 的情况，发现 "),n("code",[t._v("test.vue")]),t._v(" 依旧会被拆包。可能很多 "),n("code",[t._v("GYM")]),t._v(" 都以为"),n("strong",[t._v("需要同时满足两个条件才会拆包")]),t._v("，包括我也是"),n("strong",[t._v("深信不疑")]),t._v("（直到做了这个实验...）")]),t._v(" "),n("p",[n("strong",[t._v("敲黑板")]),t._v("！！！"),n("strong",[t._v("敲黑板")]),t._v("！！！"),n("strong",[t._v("敲黑板")]),t._v("！！！")]),t._v(" "),n("p",[t._v("其实出现上面情况，还跟 "),n("code",[t._v("chunks")]),t._v(" 有关。"),n("code",[t._v("chunks")]),t._v(" 可取 "),n("code",[t._v("initial")]),t._v("、"),n("code",[t._v("async")]),t._v("、"),n("code",[t._v("all")]),t._v(" 三个值，分别代表拆包的对象："),n("code",[t._v("首页所需的代码块")]),t._v("，"),n("code",[t._v("按需引入的代码块")]),t._v("，"),n("code",[t._v("所有代码块")]),t._v("。这里就不写过程了，感兴趣的话可以自己测一遍，控制好 "),n("code",[t._v("minSize")]),t._v(" 和 "),n("code",[t._v("minChunks")]),t._v(" 两个变量即可。以下是我自己测试出来的结论：")]),t._v(" "),n("ol",[n("li",[n("code",[t._v("chunks = initial")]),t._v("：仅针对首页所需的代码进行切割。"),n("code",[t._v("node_modules")]),t._v(" 会被打包到 "),n("code",[t._v("chunk-vendor.js")]),t._v("（如有配置），其他所需模块都会被打包到 "),n("code",[t._v("app.js")]),t._v("，并且非首页所需的代码，"),n("strong",[t._v("即便满足条件也不会被抽取出来")])]),t._v(" "),n("li",[n("code",[t._v("chunks = async")]),t._v("：仅针对按需加载的代码进行切割。"),n("code",[t._v("node_modules")]),t._v(" 及其他首页需要用到的代码会被打包到 "),n("code",[t._v("app.js")]),t._v("（即使有配置），而非首页需要的其他代码，"),n("strong",[t._v("只要满足 "),n("code",[t._v("minSize")]),t._v(" 且引用次数大于 1 就会被抽取出来")])]),t._v(" "),n("li",[n("code",[t._v("chunks = all")]),t._v("：针对所有代码进行切割。首先会按照 "),n("code",[t._v("cacheGroups")]),t._v(" 进行抽取，首页需要用到的代码会被打包到 "),n("code",[t._v("app.js")]),t._v("，非首页需要的其他代码，"),n("strong",[t._v("只要满足 "),n("code",[t._v("minSize")]),t._v(" 且引用次数大于 1 就会被抽取出来")])])]),t._v(" "),n("h3",{attrs:{id:"场景三-包含首页的局部引入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#场景三-包含首页的局部引入"}},[t._v("#")]),t._v(" 场景三：包含首页的局部引入")]),t._v(" "),n("p",[t._v("如题所述，在首页引入 "),n("code",[t._v("test.vue")]),t._v(" 和 "),n("code",[t._v("about.vue")]),t._v(" 两个文件中引入。")]),t._v(" "),n("p",[t._v("同样的，先改一下配置参数，使同时满足两个条件，并且将 "),n("code",[t._v("chunks")]),t._v(" 恢复为 "),n("code",[t._v("all")]),t._v("：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optimization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("splitChunks")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  chunks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"all"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 恢复为all")]),t._v("\n  minSize"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  minChunks"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[n("img",{attrs:{src:a(376),alt:"包含首页的局部引入-同时满足",title:"包含首页的局部引入-同时满足"}})]),t._v(" "),n("p",[t._v("从上图可以看出，"),n("code",[t._v("test.vue")]),t._v(" 被打包到 "),n("code",[t._v("app.js")]),t._v(" 中去，而非提取出来。由此可见，条件不满足的情况下更不可能抽取出来。")]),t._v(" "),n("h2",{attrs:{id:"淦完了-总结一个"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#淦完了-总结一个"}},[t._v("#")]),t._v(" 淦完了，总结一个")]),t._v(" "),n("p",[t._v("到这里，"),n("code",[t._v("minSize")]),t._v("、"),n("code",[t._v("minChunks")]),t._v(" 与 "),n("code",[t._v("import")]),t._v(" 方式之间会产生什么化学反应应该都比较明朗了。")]),t._v(" "),n("p",[t._v("一般情况下，我们更多的是针对所有代码块进行切割，对于 "),n("code",[t._v("async")]),t._v(" 会缺少对首页的处理，"),n("code",[t._v("initial")]),t._v(" 会缺少对其他非首页模块的处理，"),n("code",[t._v("GYM")]),t._v(" 可以去尝试一下")]),t._v(" "),n("p",[n("strong",[t._v("以下的结论也主要是针对 "),n("code",[t._v("chunks = all")]),t._v(" 的结果")]),t._v("：")]),t._v(" "),n("ol",[n("li",[t._v("全局引入的代码块，都将被并入 "),n("code",[t._v("app.js")]),t._v(" 下，因此需要慎重考虑哪些需要全局引入，哪些需要局部引入（区分首页是否需要引入）")]),t._v(" "),n("li",[t._v("首页需要引入的代码块，对于局部引入还是全局引入没有区别，都会被合并到 "),n("code",[t._v("app.js")]),t._v(" 中去")]),t._v(" "),n("li",[t._v("按需引入的代码块，可以从全局的角度去考虑 "),n("code",[t._v("minSize")]),t._v(" 和 "),n("code",[t._v("minChunks")]),t._v(" 的值（过多的抽取公共代码会导致请求的增加，相反地虽然可以减少请求，但是会增加 "),n("code",[t._v("chunk")]),t._v(" 的体积，因此综合考虑性能与代价是一件很必要的事）")])]),t._v(" "),n("h2",{attrs:{id:"写在最后"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#写在最后"}},[t._v("#")]),t._v(" 写在最后")]),t._v(" "),n("p",[t._v("以上是所有实验内容，有兴趣可以对 "),n("code",[t._v("async")]),t._v("、"),n("code",[t._v("initial")]),t._v("、多入口项目等淦一遍，可能会有惊喜呦 😎~")]),t._v(" "),n("p",[t._v("测试代码相对比较简单，建议还是根据实际项目去做优化。思想掌握了，实现就不难了")]),t._v(" "),n("p",[t._v("如果对以上内容有问题，欢迎指教")]),t._v(" "),n("p",[t._v("我是枸哥，可以叫我杞爷")])])}),[],!1,null,null,null);s.default=e.exports}}]);